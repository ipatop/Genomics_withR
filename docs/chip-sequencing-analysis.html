<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Lab 5 Chip Sequencing Analysis | Genomics with R for biologists</title>
  <meta name="description" content="This is the index for the coursebook" />
  <meta name="generator" content="bookdown 0.19 and GitBook 2.6.7" />

  <meta property="og:title" content="Lab 5 Chip Sequencing Analysis | Genomics with R for biologists" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="This is the index for the coursebook" />
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Lab 5 Chip Sequencing Analysis | Genomics with R for biologists" />
  
  <meta name="twitter:description" content="This is the index for the coursebook" />
  

<meta name="author" content="Ines Lucia Patop inespatop@brandeis.edu" />


<meta name="date" content="2020-07-08" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="sequencing-techniques-and-preprocessing.html"/>
<link rel="next" href="rna-seq-analysis.html"/>
<script src="libs/header-attrs-2.2/header-attrs.js"></script>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />











<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="include/psyteachr.css" type="text/css" />
<link rel="stylesheet" href="include/style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Genomics with R for biologists</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Overview</a>
<ul>
<li class="chapter" data-level="0.1" data-path="index.html"><a href="index.html#course-aims"><i class="fa fa-check"></i><b>0.1</b> Course Aims</a></li>
<li class="chapter" data-level="0.2" data-path="index.html"><a href="index.html#intended-learning-outcomes"><i class="fa fa-check"></i><b>0.2</b> Intended Learning Outcomes</a></li>
<li class="chapter" data-level="0.3" data-path="index.html"><a href="index.html#next-steps"><i class="fa fa-check"></i><b>0.3</b> Next steps</a></li>
<li class="chapter" data-level="0.4" data-path="index.html"><a href="index.html#data-availability"><i class="fa fa-check"></i><b>0.4</b> Data availability</a></li>
<li class="chapter" data-level="0.5" data-path="index.html"><a href="index.html#acknowledgments"><i class="fa fa-check"></i><b>0.5</b> Acknowledgments</a></li>
</ul></li>
<li class="chapter" data-level="1" data-path="introduction-to-r-and-rstudio.html"><a href="introduction-to-r-and-rstudio.html"><i class="fa fa-check"></i><b>1</b> Introduction to R and RStudio</a>
<ul>
<li class="chapter" data-level="1.1" data-path="introduction-to-r-and-rstudio.html"><a href="introduction-to-r-and-rstudio.html#objectives"><i class="fa fa-check"></i><b>1.1</b> Objectives</a></li>
<li class="chapter" data-level="1.2" data-path="introduction-to-r-and-rstudio.html"><a href="introduction-to-r-and-rstudio.html#introduction"><i class="fa fa-check"></i><b>1.2</b> Introduction</a></li>
<li class="chapter" data-level="1.3" data-path="introduction-to-r-and-rstudio.html"><a href="introduction-to-r-and-rstudio.html#rstudio-world"><i class="fa fa-check"></i><b>1.3</b> RStudio world</a></li>
<li class="chapter" data-level="1.4" data-path="introduction-to-r-and-rstudio.html"><a href="introduction-to-r-and-rstudio.html#create-a-project"><i class="fa fa-check"></i><b>1.4</b> Create a project</a></li>
<li class="chapter" data-level="1.5" data-path="introduction-to-r-and-rstudio.html"><a href="introduction-to-r-and-rstudio.html#useful-shortcuts-in-rstudio"><i class="fa fa-check"></i><b>1.5</b> Useful shortcuts in RStudio:</a></li>
<li class="chapter" data-level="1.6" data-path="introduction-to-r-and-rstudio.html"><a href="introduction-to-r-and-rstudio.html#installing-and-loading-packages"><i class="fa fa-check"></i><b>1.6</b> Installing and loading packages</a></li>
<li class="chapter" data-level="1.7" data-path="introduction-to-r-and-rstudio.html"><a href="introduction-to-r-and-rstudio.html#creating-objects"><i class="fa fa-check"></i><b>1.7</b> Creating objects</a></li>
<li class="chapter" data-level="1.8" data-path="introduction-to-r-and-rstudio.html"><a href="introduction-to-r-and-rstudio.html#r-as-a-calculator"><i class="fa fa-check"></i><b>1.8</b> R as a calculator</a></li>
<li class="chapter" data-level="1.9" data-path="introduction-to-r-and-rstudio.html"><a href="introduction-to-r-and-rstudio.html#functions"><i class="fa fa-check"></i><b>1.9</b> Functions</a></li>
<li class="chapter" data-level="1.10" data-path="introduction-to-r-and-rstudio.html"><a href="introduction-to-r-and-rstudio.html#loops"><i class="fa fa-check"></i><b>1.10</b> Loops</a></li>
<li class="chapter" data-level="1.11" data-path="introduction-to-r-and-rstudio.html"><a href="introduction-to-r-and-rstudio.html#conditions"><i class="fa fa-check"></i><b>1.11</b> Conditions</a></li>
<li class="chapter" data-level="1.12" data-path="introduction-to-r-and-rstudio.html"><a href="introduction-to-r-and-rstudio.html#character-objects"><i class="fa fa-check"></i><b>1.12</b> Character objects</a></li>
<li class="chapter" data-level="1.13" data-path="introduction-to-r-and-rstudio.html"><a href="introduction-to-r-and-rstudio.html#identify"><i class="fa fa-check"></i><b>1.13</b> Identify</a></li>
<li class="chapter" data-level="1.14" data-path="introduction-to-r-and-rstudio.html"><a href="introduction-to-r-and-rstudio.html#modify"><i class="fa fa-check"></i><b>1.14</b> Modify</a></li>
<li class="chapter" data-level="1.15" data-path="introduction-to-r-and-rstudio.html"><a href="introduction-to-r-and-rstudio.html#useful-resources"><i class="fa fa-check"></i><b>1.15</b> Useful resources</a></li>
<li class="chapter" data-level="1.16" data-path="introduction-to-r-and-rstudio.html"><a href="introduction-to-r-and-rstudio.html#activity"><i class="fa fa-check"></i><b>1.16</b> Activity:</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="data-manipulation.html"><a href="data-manipulation.html"><i class="fa fa-check"></i><b>2</b> Data manipulation</a>
<ul>
<li class="chapter" data-level="2.1" data-path="data-manipulation.html"><a href="data-manipulation.html#objectives-1"><i class="fa fa-check"></i><b>2.1</b> Objectives</a></li>
<li class="chapter" data-level="2.2" data-path="data-manipulation.html"><a href="data-manipulation.html#introduction-1"><i class="fa fa-check"></i><b>2.2</b> Introduction</a></li>
<li class="chapter" data-level="2.3" data-path="data-manipulation.html"><a href="data-manipulation.html#load-data"><i class="fa fa-check"></i><b>2.3</b> Load data</a></li>
<li class="chapter" data-level="2.4" data-path="data-manipulation.html"><a href="data-manipulation.html#data-exploration"><i class="fa fa-check"></i><b>2.4</b> Data exploration</a></li>
<li class="chapter" data-level="2.5" data-path="data-manipulation.html"><a href="data-manipulation.html#subsetting"><i class="fa fa-check"></i><b>2.5</b> Subsetting</a></li>
<li class="chapter" data-level="2.6" data-path="data-manipulation.html"><a href="data-manipulation.html#activity-1"><i class="fa fa-check"></i><b>2.6</b> Activity:</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="visualization-and-statistical-test.html"><a href="visualization-and-statistical-test.html"><i class="fa fa-check"></i><b>3</b> Visualization and Statistical test</a>
<ul>
<li class="chapter" data-level="3.1" data-path="visualization-and-statistical-test.html"><a href="visualization-and-statistical-test.html#objectives-2"><i class="fa fa-check"></i><b>3.1</b> Objectives</a></li>
<li class="chapter" data-level="3.2" data-path="visualization-and-statistical-test.html"><a href="visualization-and-statistical-test.html#introduction-2"><i class="fa fa-check"></i><b>3.2</b> Introduction</a></li>
<li class="chapter" data-level="3.3" data-path="visualization-and-statistical-test.html"><a href="visualization-and-statistical-test.html#plots"><i class="fa fa-check"></i><b>3.3</b> Plots</a>
<ul>
<li class="chapter" data-level="3.3.1" data-path="visualization-and-statistical-test.html"><a href="visualization-and-statistical-test.html#line-and-points"><i class="fa fa-check"></i><b>3.3.1</b> Line and points</a></li>
<li class="chapter" data-level="3.3.2" data-path="visualization-and-statistical-test.html"><a href="visualization-and-statistical-test.html#historgam-and-density-plots"><i class="fa fa-check"></i><b>3.3.2</b> Historgam and density plots</a></li>
<li class="chapter" data-level="3.3.3" data-path="visualization-and-statistical-test.html"><a href="visualization-and-statistical-test.html#boxplot"><i class="fa fa-check"></i><b>3.3.3</b> Boxplot</a></li>
<li class="chapter" data-level="3.3.4" data-path="visualization-and-statistical-test.html"><a href="visualization-and-statistical-test.html#saving-plots"><i class="fa fa-check"></i><b>3.3.4</b> Saving plots</a></li>
</ul></li>
<li class="chapter" data-level="3.4" data-path="visualization-and-statistical-test.html"><a href="visualization-and-statistical-test.html#statistical-test"><i class="fa fa-check"></i><b>3.4</b> Statistical test</a>
<ul>
<li class="chapter" data-level="3.4.1" data-path="visualization-and-statistical-test.html"><a href="visualization-and-statistical-test.html#descriptive-statistics"><i class="fa fa-check"></i><b>3.4.1</b> Descriptive statistics</a></li>
<li class="chapter" data-level="3.4.2" data-path="visualization-and-statistical-test.html"><a href="visualization-and-statistical-test.html#t-testwilcoxon"><i class="fa fa-check"></i><b>3.4.2</b> T-test/Wilcoxon</a></li>
<li class="chapter" data-level="3.4.3" data-path="visualization-and-statistical-test.html"><a href="visualization-and-statistical-test.html#anovakruskalwallis"><i class="fa fa-check"></i><b>3.4.3</b> Anova/Kruskal–Wallis</a></li>
</ul></li>
<li class="chapter" data-level="3.5" data-path="visualization-and-statistical-test.html"><a href="visualization-and-statistical-test.html#activity-2"><i class="fa fa-check"></i><b>3.5</b> Activity:</a></li>
<li class="chapter" data-level="3.6" data-path="visualization-and-statistical-test.html"><a href="visualization-and-statistical-test.html#resources"><i class="fa fa-check"></i><b>3.6</b> Resources</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="sequencing-techniques-and-preprocessing.html"><a href="sequencing-techniques-and-preprocessing.html"><i class="fa fa-check"></i><b>4</b> Sequencing techniques and preprocessing</a>
<ul>
<li class="chapter" data-level="4.1" data-path="sequencing-techniques-and-preprocessing.html"><a href="sequencing-techniques-and-preprocessing.html#objectives-3"><i class="fa fa-check"></i><b>4.1</b> Objectives</a></li>
<li class="chapter" data-level="4.2" data-path="sequencing-techniques-and-preprocessing.html"><a href="sequencing-techniques-and-preprocessing.html#introduction-3"><i class="fa fa-check"></i><b>4.2</b> Introduction</a></li>
<li class="chapter" data-level="4.3" data-path="sequencing-techniques-and-preprocessing.html"><a href="sequencing-techniques-and-preprocessing.html#different-type-of-data-dna-rna-splicing-single-end-paired-end"><i class="fa fa-check"></i><b>4.3</b> Different type of data (DNA, RNA, splicing, single-end paired-end)</a></li>
<li class="chapter" data-level="4.4" data-path="sequencing-techniques-and-preprocessing.html"><a href="sequencing-techniques-and-preprocessing.html#from-the-sequencer-machine-to-the-sequence"><i class="fa fa-check"></i><b>4.4</b> From the sequencer machine to the sequence</a></li>
<li class="chapter" data-level="4.5" data-path="sequencing-techniques-and-preprocessing.html"><a href="sequencing-techniques-and-preprocessing.html#general-processing"><i class="fa fa-check"></i><b>4.5</b> General processing</a>
<ul>
<li class="chapter" data-level="4.5.1" data-path="sequencing-techniques-and-preprocessing.html"><a href="sequencing-techniques-and-preprocessing.html#visualization-of-alignment-igv"><i class="fa fa-check"></i><b>4.5.1</b> Visualization of alignment (IGV)</a></li>
<li class="chapter" data-level="4.5.2" data-path="sequencing-techniques-and-preprocessing.html"><a href="sequencing-techniques-and-preprocessing.html#gene-counts-read-esat-feature-counts-peak-calling"><i class="fa fa-check"></i><b>4.5.2</b> Gene counts / read (esat feature counts) /peak calling</a></li>
</ul></li>
<li class="chapter" data-level="4.6" data-path="sequencing-techniques-and-preprocessing.html"><a href="sequencing-techniques-and-preprocessing.html#using-the-terminal"><i class="fa fa-check"></i><b>4.6</b> Using the terminal</a></li>
<li class="chapter" data-level="4.7" data-path="sequencing-techniques-and-preprocessing.html"><a href="sequencing-techniques-and-preprocessing.html#a-bit-of-shell-commands"><i class="fa fa-check"></i><b>4.7</b> A bit of shell commands</a></li>
<li class="chapter" data-level="4.8" data-path="sequencing-techniques-and-preprocessing.html"><a href="sequencing-techniques-and-preprocessing.html#resources-and-bibliography"><i class="fa fa-check"></i><b>4.8</b> Resources and Bibliography</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="chip-sequencing-analysis.html"><a href="chip-sequencing-analysis.html"><i class="fa fa-check"></i><b>5</b> Chip Sequencing Analysis</a>
<ul>
<li class="chapter" data-level="5.1" data-path="chip-sequencing-analysis.html"><a href="chip-sequencing-analysis.html#objectives-4"><i class="fa fa-check"></i><b>5.1</b> Objectives</a></li>
<li class="chapter" data-level="5.2" data-path="chip-sequencing-analysis.html"><a href="chip-sequencing-analysis.html#introduction-4"><i class="fa fa-check"></i><b>5.2</b> Introduction</a></li>
<li class="chapter" data-level="5.3" data-path="chip-sequencing-analysis.html"><a href="chip-sequencing-analysis.html#data-pre-processing-peak-calling"><i class="fa fa-check"></i><b>5.3</b> Data pre-processing (peak-calling):</a></li>
<li class="chapter" data-level="5.4" data-path="chip-sequencing-analysis.html"><a href="chip-sequencing-analysis.html#exploring-the-results"><i class="fa fa-check"></i><b>5.4</b> Exploring the results:</a></li>
<li class="chapter" data-level="5.5" data-path="chip-sequencing-analysis.html"><a href="chip-sequencing-analysis.html#annotating-the-peaks."><i class="fa fa-check"></i><b>5.5</b> Annotating the peaks.</a>
<ul>
<li class="chapter" data-level="5.5.1" data-path="chip-sequencing-analysis.html"><a href="chip-sequencing-analysis.html#read-the-annotation-file"><i class="fa fa-check"></i><b>5.5.1</b> Read the annotation file</a></li>
<li class="chapter" data-level="5.5.2" data-path="chip-sequencing-analysis.html"><a href="chip-sequencing-analysis.html#get-the-genes-from-this-annotation-data-base"><i class="fa fa-check"></i><b>5.5.2</b> Get the genes from this annotation data base</a></li>
<li class="chapter" data-level="5.5.3" data-path="chip-sequencing-analysis.html"><a href="chip-sequencing-analysis.html#get-the-genomic-ranges-of-the-peaks-from-macs-and-find-which-gene-is-closer-to-them-ie.-annotate-them"><i class="fa fa-check"></i><b>5.5.3</b> Get the genomic ranges of the peaks from MACS and find which gene is closer to them (ie. Annotate them)</a></li>
<li class="chapter" data-level="5.5.4" data-path="chip-sequencing-analysis.html"><a href="chip-sequencing-analysis.html#change-the-gene-format."><i class="fa fa-check"></i><b>5.5.4</b> Change the gene format.</a></li>
<li class="chapter" data-level="5.5.5" data-path="chip-sequencing-analysis.html"><a href="chip-sequencing-analysis.html#explore-and-export-the-table"><i class="fa fa-check"></i><b>5.5.5</b> Explore and export the table</a></li>
</ul></li>
<li class="chapter" data-level="5.6" data-path="chip-sequencing-analysis.html"><a href="chip-sequencing-analysis.html#annotate-with-chipseeker"><i class="fa fa-check"></i><b>5.6</b> Annotate with <code>ChIPseeker</code></a>
<ul>
<li class="chapter" data-level="5.6.1" data-path="chip-sequencing-analysis.html"><a href="chip-sequencing-analysis.html#explore-and-export-the-output"><i class="fa fa-check"></i><b>5.6.1</b> Explore and Export the output</a></li>
<li class="chapter" data-level="5.6.2" data-path="chip-sequencing-analysis.html"><a href="chip-sequencing-analysis.html#positive-controls."><i class="fa fa-check"></i><b>5.6.2</b> Positive controls.</a></li>
<li class="chapter" data-level="5.6.3" data-path="chip-sequencing-analysis.html"><a href="chip-sequencing-analysis.html#plots-1"><i class="fa fa-check"></i><b>5.6.3</b> Plots</a></li>
</ul></li>
<li class="chapter" data-level="5.7" data-path="chip-sequencing-analysis.html"><a href="chip-sequencing-analysis.html#sequence-motif-analysis"><i class="fa fa-check"></i><b>5.7</b> Sequence Motif analysis</a>
<ul>
<li class="chapter" data-level="5.7.1" data-path="chip-sequencing-analysis.html"><a href="chip-sequencing-analysis.html#put-the-peak-sequences-in-fasta-format"><i class="fa fa-check"></i><b>5.7.1</b> Put the peak sequences in fasta format</a></li>
<li class="chapter" data-level="5.7.2" data-path="chip-sequencing-analysis.html"><a href="chip-sequencing-analysis.html#find-the-motifs"><i class="fa fa-check"></i><b>5.7.2</b> Find the MOTIFS</a></li>
<li class="chapter" data-level="5.7.3" data-path="chip-sequencing-analysis.html"><a href="chip-sequencing-analysis.html#explore-the-results"><i class="fa fa-check"></i><b>5.7.3</b> Explore the results</a></li>
<li class="chapter" data-level="5.7.4" data-path="chip-sequencing-analysis.html"><a href="chip-sequencing-analysis.html#plot-the-results"><i class="fa fa-check"></i><b>5.7.4</b> Plot the results</a></li>
<li class="chapter" data-level="5.7.5" data-path="chip-sequencing-analysis.html"><a href="chip-sequencing-analysis.html#plotting-with-ggplot2"><i class="fa fa-check"></i><b>5.7.5</b> Plotting with Ggplot2</a></li>
</ul></li>
<li class="chapter" data-level="5.8" data-path="chip-sequencing-analysis.html"><a href="chip-sequencing-analysis.html#extra-how-to-solve-some-common-annotation-issues."><i class="fa fa-check"></i><b>5.8</b> Extra: How to solve some common annotation issues.</a></li>
<li class="chapter" data-level="5.9" data-path="chip-sequencing-analysis.html"><a href="chip-sequencing-analysis.html#extra-detailed-explanation-of-the-macs-output-files"><i class="fa fa-check"></i><b>5.9</b> Extra: Detailed explanation of the MACS output files</a></li>
<li class="chapter" data-level="5.10" data-path="chip-sequencing-analysis.html"><a href="chip-sequencing-analysis.html#activity-3"><i class="fa fa-check"></i><b>5.10</b> Activity</a></li>
<li class="chapter" data-level="5.11" data-path="chip-sequencing-analysis.html"><a href="chip-sequencing-analysis.html#resources-and-bibliography-1"><i class="fa fa-check"></i><b>5.11</b> Resources and Bibliography</a></li>
<li class="chapter" data-level="5.12" data-path="chip-sequencing-analysis.html"><a href="chip-sequencing-analysis.html#session-info-all-the-packages-installed."><i class="fa fa-check"></i><b>5.12</b> Session info: all the packages installed.</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="rna-seq-analysis.html"><a href="rna-seq-analysis.html"><i class="fa fa-check"></i><b>6</b> RNA seq analysis</a>
<ul>
<li class="chapter" data-level="6.1" data-path="rna-seq-analysis.html"><a href="rna-seq-analysis.html#objectives-5"><i class="fa fa-check"></i><b>6.1</b> Objectives</a></li>
<li class="chapter" data-level="6.2" data-path="rna-seq-analysis.html"><a href="rna-seq-analysis.html#introduction-5"><i class="fa fa-check"></i><b>6.2</b> Introduction</a></li>
<li class="chapter" data-level="6.3" data-path="rna-seq-analysis.html"><a href="rna-seq-analysis.html#differential-gene-expression"><i class="fa fa-check"></i><b>6.3</b> Differential gene expression</a>
<ul>
<li class="chapter" data-level="6.3.1" data-path="rna-seq-analysis.html"><a href="rna-seq-analysis.html#loading-the-tables"><i class="fa fa-check"></i><b>6.3.1</b> Loading the tables</a></li>
<li class="chapter" data-level="6.3.2" data-path="rna-seq-analysis.html"><a href="rna-seq-analysis.html#create-the-deseq2-count-matrix"><i class="fa fa-check"></i><b>6.3.2</b> Create the DeSeq2 count matrix</a></li>
<li class="chapter" data-level="6.3.3" data-path="rna-seq-analysis.html"><a href="rna-seq-analysis.html#coldata-preparation"><i class="fa fa-check"></i><b>6.3.3</b> colData preparation</a></li>
<li class="chapter" data-level="6.3.4" data-path="rna-seq-analysis.html"><a href="rna-seq-analysis.html#heat-map-pca-analysis"><i class="fa fa-check"></i><b>6.3.4</b> Heat-map PCA analysis</a></li>
<li class="chapter" data-level="6.3.5" data-path="rna-seq-analysis.html"><a href="rna-seq-analysis.html#differential-gene-expression-analysis-between-zt."><i class="fa fa-check"></i><b>6.3.5</b> Differential gene expression analysis between ZT.</a></li>
<li class="chapter" data-level="6.3.6" data-path="rna-seq-analysis.html"><a href="rna-seq-analysis.html#plot-counts-using-ggplot"><i class="fa fa-check"></i><b>6.3.6</b> Plot counts using ggplot</a></li>
</ul></li>
<li class="chapter" data-level="6.4" data-path="rna-seq-analysis.html"><a href="rna-seq-analysis.html#cycling-genes-analysis"><i class="fa fa-check"></i><b>6.4</b> Cycling genes analysis</a></li>
<li class="chapter" data-level="6.5" data-path="rna-seq-analysis.html"><a href="rna-seq-analysis.html#activity-4"><i class="fa fa-check"></i><b>6.5</b> Activity</a></li>
<li class="chapter" data-level="6.6" data-path="rna-seq-analysis.html"><a href="rna-seq-analysis.html#extra-heatmap-and-pca-in-the-other-celltypes."><i class="fa fa-check"></i><b>6.6</b> Extra: Heatmap and PCA in the other celltypes.</a></li>
<li class="chapter" data-level="6.7" data-path="rna-seq-analysis.html"><a href="rna-seq-analysis.html#extra-advanced-cycling-genes-analysis"><i class="fa fa-check"></i><b>6.7</b> Extra: Advanced cycling genes analysis</a></li>
<li class="chapter" data-level="6.8" data-path="rna-seq-analysis.html"><a href="rna-seq-analysis.html#extra-negative-binomial-model"><i class="fa fa-check"></i><b>6.8</b> Extra: negative binomial model</a></li>
<li class="chapter" data-level="6.9" data-path="rna-seq-analysis.html"><a href="rna-seq-analysis.html#resources-and-bibliography-2"><i class="fa fa-check"></i><b>6.9</b> Resources and Bibliography</a></li>
</ul></li>
<li class="appendix"><span><b>Appendices</b></span></li>
<li class="divider"></li>
<li><a rel="license" href="https://creativecommons.org/licenses/by-sa/4.0/" 
    target="blank"><img alt="Creative Commons License" 
    style="border-width:0" 
    src="https://i.creativecommons.org/l/by-sa/4.0/88x31.png" /></a><li>
<li><a href="https://psyteachr.github.io/" target="blank">PsyTeachR</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Genomics with R for biologists</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="chip-sequencing-analysis" class="section level1" number="5">
<h1><span class="header-section-number">Lab 5</span> Chip Sequencing Analysis</h1>
<div id="objectives-4" class="section level2" number="5.1">
<h2><span class="header-section-number">5.1</span> Objectives</h2>
<p>After this section you should be able to:</p>
<ol style="list-style-type: decimal">
<li>Explore results from ChipSeq data.</li>
<li>Modify tables and change gene names.</li>
<li>Use different ChipSeq gene annotation packages from R.</li>
<li>Find sequence motif enrichment in sequencing data.</li>
</ol>
</div>
<div id="introduction-4" class="section level2" number="5.2">
<h2><span class="header-section-number">5.2</span> Introduction</h2>
<p><strong>Chip-seq procedure:</strong></p>
<p>“ChIP-seq” is short for “chromatin immunoprecipitation (ChIP) followed by sequencing (seq)”. ChipSeq data is basically DNA sequencing data in which the DNA is sequenced AFTER immunoprecipitating a protein of interest. Therefore, we expect to sequence the pieces of DNA that are interacting with the precipitated protein.</p>
<p>If the protein of interest is a transcription factor (TF) for example, we expect to get the regions of DNA close to the genes that are being regulated by this particular TF (ie. the promoters of the genes). If we immunoprecipitate RNA polymerase 2, we expect to get the regions of the DNA that are being transcribed to RNA.</p>
<p>But, how do we know if certain region of the genome is really interreacting with the protein of interest? As in any analysis, it is important to have a control to see the probability to have a signal in a particular region just by chance. Usually as a control we use the DNA sequencing BEFORE immunoprecipitation (IP). This data is usually called input (INP), as it is the input material used for the IP. What we are looking then will be “enrichment” of each region of the genome in the IP compared with the INP.</p>
<p>The biochemical procedure usually goes as follows:</p>
<div class="figure" style="text-align: center"><span id="fig:unnamed-chunk-1"></span>
<img src="macs2_analysis_p0.05/chipseqproc.png" alt="Commonly used ChipSeq procedure. DNA is fragmented followed by immunoprecipitation for the protein of interest. Finally, DNA library is prepared and sequenced. As you can see there is an enrichment of the DNA regions bonded to the protein of interest." width="500px" />
<p class="caption">
Figure 1.1: Commonly used ChipSeq procedure. DNA is fragmented followed by immunoprecipitation for the protein of interest. Finally, DNA library is prepared and sequenced. As you can see there is an enrichment of the DNA regions bonded to the protein of interest.
</p>
</div>
<p>To study this type of data we will re-analyze the data generated in <a href="https://www.cell.com/current-biology/fulltext/S0960-9822(13)01403-6?_returnURL=https%3A%2F%2Flinkinghub.elsevier.com%2Fretrieve%2Fpii%2FS0960982213014036%3Fshowall%3Dtrue1">Meireles-Filho et al 2014</a>.</p>
<p>In this work the authors study genome-wide the binding of two transcription factors (Clk and Cyc) in the fruit fly (<em>Drosophila melanogaster</em>). To do so they do Chip sequencing.</p>
<p>These two transcription factors are core components of the circadian clock in animals. Just as an introduction these two transcription factors bind to specific regions on the genome and activate transcription. Clk oscilates over the day due to a set of feedback loops with other core-clock components. These set of molecular interactions generate an autonomous oscilating molecular clock with a period of almost 24 hr. This clock can be re-set by light input. We will study RNA oscilations over the day in next chapter.</p>
<div class="figure" style="text-align: center"><span id="fig:unnamed-chunk-2"></span>
<img src="macs2_analysis_p0.05/clkcyc.png" alt="Circadian clock at the molecular level. The molecular feedback loop is formed by the negative feedback of Period (PER) and Timeless (TIM) on their own transcription. Figure adapted from Dubowy et al 2017" width="500px" />
<p class="caption">
Figure 4.1: Circadian clock at the molecular level. The molecular feedback loop is formed by the negative feedback of Period (PER) and Timeless (TIM) on their own transcription. Figure adapted from Dubowy et al 2017
</p>
</div>
<div class="figure" style="text-align: center"><span id="fig:unnamed-chunk-3"></span>
<img src="macs2_analysis_p0.05/clkcycosc.png" alt="Cyc, Clk and Time levels over the day. Figure adapted from Alves Meireles-Filho et al 2013" width="500px" />
<p class="caption">
Figure 4.2: Cyc, Clk and Time levels over the day. Figure adapted from Alves Meireles-Filho et al 2013
</p>
</div>
<div class="figure" style="text-align: center"><span id="fig:unnamed-chunk-4"></span>
<img src="macs2_analysis_p0.05/clkcycosc.png" alt="Light control of the circadian clock. Figure adapted from Alves Meireles-Filho et al 2013" width="500px" />
<p class="caption">
Figure 4.3: Light control of the circadian clock. Figure adapted from Alves Meireles-Filho et al 2013
</p>
</div>
</div>
<div id="data-pre-processing-peak-calling" class="section level2" number="5.3">
<h2><span class="header-section-number">5.3</span> Data pre-processing (peak-calling):</h2>
<p>Our goal is then to quantify signal enrichment in certain part of the genome in IP vs INP sequencing. This is achieved by comparing the ALIGNEMENT of the reads of IP vs INP.</p>
<p>This process is called “peak calling” because it is trying to determine the “pileup” of reads along the genome forming “peaks”. As any peak the algorithm used will report high of the peak, summit location, width and finally a pvalue corresponding to the comparison of the signal in that region in IP vs INP.</p>
<p>Here we can see how the pileup reads look like in IGV. We are looking here at the promoter of the genes <em>tim</em>, a known target of CLK protein. As you can see, the peak is clear in the IP comapred with the INP.</p>
<div class="figure" style="text-align: center"><span id="fig:unnamed-chunk-5"></span>
<img src="macs2_analysis_p0.05/IGVtim.png" alt="IGV pileup traks over tim. Upper line IP, lower line INP." width="900px" />
<p class="caption">
Figure 4.4: IGV pileup traks over tim. Upper line IP, lower line INP.
</p>
</div>
<p>To do this analysis genome wide, we need a tool that can do this for all the genom. There are few tools available, we use here <a href="https://github.com/taoliu/MACS">MACS</a> algorithm to assess the peaks from the sequencing data.</p>
<p>Basically, this analysis relies in the aligned data (.bam files). It compares the IP with the INP control.</p>
<p>For this analysis I aligned the data from <a href="https://www.ncbi.nlm.nih.gov/geo/query/acc.cgi?acc=GSE40467">GEO</a> with <a href="http://bowtie-bio.sourceforge.net/bowtie2/manual.shtml">Bowtie2</a>, an aligner that is used for DNA data (not splice aware).</p>
<p>Finally ran the MACS command in the <strong>terminal</strong> as follows:</p>
<pre><code>macs2 callpeak -t head_clk_ip_rep1.sorted.bam head_clk_ip_rep2.sorted.bam  -c ./head_clk_input_rep1.sorted.bam ./head_clk_input_rep2.sorted.bam -g dm -n PeakAna_clk_Ip_vs_INP -B -p 0.05</code></pre>
<p>Where, -t indicates that the following arguments are the IP samples, -c the control samples, -g the genome name in this case “dm”, -n the name that all the output files will have, -B indicates to the program to store visualization files (in <a href="https://software.broadinstitute.org/software/igv/bedgraph">.bdg</a> format usefull to visualize in IGV).</p>
<p>The <strong>output</strong> after running MACS on the shell:</p>
<table>
<colgroup>
<col width="18%" />
<col width="81%" />
</colgroup>
<thead>
<tr class="header">
<th>File name</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>PeakAna_clk_Ip_vs_INP_model.r</td>
<td>An R script for producing a PDF illustrating the peak model</td>
</tr>
<tr class="even">
<td>PeakAna_clk_Ip_vs_INP_model.pdf</td>
<td>The PDF image of the read distribution in model peaks and fragment size estimation</td>
</tr>
<tr class="odd">
<td>PeakAna_clk_Ip_vs_INP_peaks.xls</td>
<td>Key parameters used by MACS and detailed information of every peak identified by MACS</td>
</tr>
<tr class="even">
<td>PeakAna_clk_Ip_vs_INP_peaks.bed</td>
<td>Peak locations in BED format</td>
</tr>
<tr class="odd">
<td>PeakAna_clk_Ip_vs_INP_peaks.subpeaks.bed</td>
<td>Subpeak locations in BED-like format. This file is generated by PeakSplitter, which is called by MACS</td>
</tr>
<tr class="even">
<td>PeakAna_clk_Ip_vs_INP_summits.bed</td>
<td>Summit locations of the peaks in BED format</td>
</tr>
<tr class="odd">
<td>PeakAna_clk_Ip_vs_INP_MACS_bedGraph</td>
<td>Directory where the BedGraph files are generated. For each control or ChIP-seq sample, a BedGraph file describes the read distribution along the whole genome</td>
</tr>
</tbody>
</table>
</div>
<div id="exploring-the-results" class="section level2" number="5.4">
<h2><span class="header-section-number">5.4</span> Exploring the results:</h2>
<p>We will see the first part of the output we get in the “NAME_peaks.xls”:</p>
<p>We can see here that we have all the columns we expect and we cqn try to see places we know are interesting for us.</p>
<div class="sourceCode" id="cb193"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb193-1"><a href="chip-sequencing-analysis.html#cb193-1"></a><span class="co">#knitr::include_graphics(&#39;images/hex-rmarkdown.png&#39;)</span></span>
<span id="cb193-2"><a href="chip-sequencing-analysis.html#cb193-2"></a>macs.res&lt;-<span class="kw">read.table</span>(<span class="st">&quot;../macs2_analysis_p0.05/PeakAna_clk_Ip_vs_INP_peaks_bed.txt&quot;</span>,<span class="dt">header =</span> T)</span>
<span id="cb193-3"><a href="chip-sequencing-analysis.html#cb193-3"></a><span class="kw">head</span>(macs.res)</span></code></pre></div>
<pre><code>##     chr start   end length abs_summit pileup X.log10.pvalue. fold_enrichment
## 1 chr2L 34224 34348    125      34306  20.88         2.75497         1.97319
## 2 chr2L 34965 35180    216      35108  23.26         3.33362         2.02190
## 3 chr2L 40369 40577    209      40492  30.42         7.01721         2.83398
## 4 chr2L 57282 57429    148      57365  22.07         3.47781         2.08079
## 5 chr2L 58368 58696    329      58541  39.37        12.02019         3.64098
## 6 chr2L 62014 62139    126      62048  19.68         2.42109         1.86559
##   X.log10.qvalue.                         name
## 1         1.12350 PeakAna_clk_Ip_vs_INP_peak_1
## 2         1.65302 PeakAna_clk_Ip_vs_INP_peak_2
## 3         5.05903 PeakAna_clk_Ip_vs_INP_peak_3
## 4         1.77350 PeakAna_clk_Ip_vs_INP_peak_4
## 5         9.82848 PeakAna_clk_Ip_vs_INP_peak_5
## 6         0.83175 PeakAna_clk_Ip_vs_INP_peak_6</code></pre>
</div>
<div id="annotating-the-peaks." class="section level2" number="5.5">
<h2><span class="header-section-number">5.5</span> Annotating the peaks.</h2>
<p>With this information we want to be able to conclude something about this transcription factor regulation.</p>
<p>The first thing to see is genes that might be regulated. This is basically looking which is the closest gene to each peak.</p>
<p>To do this we will just looking at the annotation file that have the information of which gene is in each region of the genome (we can think of this as the “map” of the genome).</p>
<blockquote>
<p>What problems you can think that this approach might have? Think about enhancers for example.</p>
</blockquote>
<p>For this we will use the following libraries:</p>
<div class="sourceCode" id="cb195"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb195-1"><a href="chip-sequencing-analysis.html#cb195-1"></a><span class="kw">library</span>(GenomicFeatures) <span class="co">#This is an R package to deal with genomic data. You can read more at https://bioconductor.org/packages/release/bioc/vignettes/GenomicFeatures/inst/doc/GenomicFeatures.pdf</span></span>
<span id="cb195-2"><a href="chip-sequencing-analysis.html#cb195-2"></a><span class="kw">library</span>(ChIPpeakAnno) <span class="co">#This is a package to annotate Chip-Peaks data https://bioconductor.org/packages/release/bioc/vignettes/ChIPpeakAnno/inst/doc/ChIPpeakAnno.html</span></span></code></pre></div>
<div id="read-the-annotation-file" class="section level3" number="5.5.1">
<h3><span class="header-section-number">5.5.1</span> Read the annotation file</h3>
<p>In class we saw what were annotation files. Those were files that contained the “map” of the genome. This map shows us where each gene start and end and where each exon, intron and UTR is in that gene.</p>
<p>We will work with a GTF file. Remember that annotation files can be in many formats. They can be downloaded from different places as UCSC genome browser, Ensemble, etc.</p>
<p>To read the GTF file we will use the <code>makeTxDbFromGFF</code> function. We are doing this because it will allow us to change it to another format, sqlite.</p>
<div class="sourceCode" id="cb196"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb196-1"><a href="chip-sequencing-analysis.html#cb196-1"></a>txdb &lt;-<span class="st"> </span><span class="kw">makeTxDbFromGFF</span>(<span class="dt">file=</span><span class="st">&quot;../macs2_analysis_p0.05/annot2.chr.gtf&quot;</span>, <span class="dt">format =</span> <span class="st">&quot;gtf&quot;</span>, <span class="dt">dataSource=</span><span class="st">&quot;dm6&quot;</span>, <span class="dt">organism=</span><span class="st">&quot;Drosophila melanogaster&quot;</span>) <span class="co">#this funciton is actually reading the GTF file and creating a data base. Try reading the help documentation of this funciton.</span></span>
<span id="cb196-2"><a href="chip-sequencing-analysis.html#cb196-2"></a></span>
<span id="cb196-3"><a href="chip-sequencing-analysis.html#cb196-3"></a><span class="co">#Now we need to save this as an sqlite:</span></span>
<span id="cb196-4"><a href="chip-sequencing-analysis.html#cb196-4"></a><span class="kw">saveDb</span>(txdb, <span class="dt">file=</span><span class="st">&quot;../macs2_analysis_p0.05/dm6.sqlite&quot;</span>) <span class="co">#Look at your working directory, what happened?</span></span>
<span id="cb196-5"><a href="chip-sequencing-analysis.html#cb196-5"></a>txdb &lt;-<span class="st"> </span><span class="kw">loadDb</span>(<span class="st">&quot;../macs2_analysis_p0.05/dm6.sqlite&quot;</span>) <span class="co">#this is loading the sqlite directly without creating the database</span></span></code></pre></div>
<pre><code>## TxDb object:
## # Db type: TxDb
## # Supporting package: GenomicFeatures
## # Data source: dm6
## # Organism: Drosophila melanogaster
## # Taxonomy ID: 7227
## # miRBase build ID: NA
## # Genome: NA
## # transcript_nrow: 34767
## # exon_nrow: 87482
## # cds_nrow: 62757
## # Db created by: GenomicFeatures package from Bioconductor
## # Creation time: 2020-07-08 18:49:22 -0400 (Wed, 08 Jul 2020)
## # GenomicFeatures version at creation time: 1.38.2
## # RSQLite version at creation time: 2.2.0
## # DBSCHEMAVERSION: 1.2</code></pre>
</div>
<div id="get-the-genes-from-this-annotation-data-base" class="section level3" number="5.5.2">
<h3><span class="header-section-number">5.5.2</span> Get the genes from this annotation data base</h3>
<p>The function <code>genes</code> actually extract the genomic ranges (chr start, end, strand, etc) from the genes in the annotation data base we are working with <code>txdb</code>.</p>
<div class="sourceCode" id="cb198"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb198-1"><a href="chip-sequencing-analysis.html#cb198-1"></a>ge &lt;-<span class="st"> </span><span class="kw">genes</span>(txdb, <span class="dt">columns=</span><span class="kw">c</span>(<span class="st">&quot;tx_name&quot;</span>, <span class="st">&quot;gene_id&quot;</span>, <span class="st">&quot;tx_type&quot;</span>)) <span class="co">#get the genes genomic ranges, what do you think are the options we are passing to this function? (read the help manual to check).</span></span>
<span id="cb198-2"><a href="chip-sequencing-analysis.html#cb198-2"></a></span>
<span id="cb198-3"><a href="chip-sequencing-analysis.html#cb198-3"></a><span class="co">#lets look at the genes:</span></span>
<span id="cb198-4"><a href="chip-sequencing-analysis.html#cb198-4"></a><span class="kw">as.data.frame</span>(<span class="kw">head</span>(ge))</span></code></pre></div>
<pre><code>##             seqnames    start      end width strand      tx_name     gene_id
## FBgn0000003    chr3R  6822498  6822796   299      +  FBtr0081624 FBgn0000003
## FBgn0000008    chr2R 22136968 22172834 35867      + FBtr0071.... FBgn0000008
## FBgn0000014    chr3R 16807214 16830049 22836      - FBtr0306.... FBgn0000014
## FBgn0000015    chr3R 16927212 16972236 45025      - FBtr0415.... FBgn0000015
## FBgn0000017    chr3L 16615866 16647882 32017      - FBtr0112.... FBgn0000017
## FBgn0000018    chr2L 10973443 10975293  1851      -  FBtr0080168 FBgn0000018
##                tx_type
## FBgn0000003 transcript
## FBgn0000008 transcript
## FBgn0000014 transcript
## FBgn0000015 transcript
## FBgn0000017 transcript
## FBgn0000018 transcript</code></pre>
</div>
<div id="get-the-genomic-ranges-of-the-peaks-from-macs-and-find-which-gene-is-closer-to-them-ie.-annotate-them" class="section level3" number="5.5.3">
<h3><span class="header-section-number">5.5.3</span> Get the genomic ranges of the peaks from MACS and find which gene is closer to them (ie. Annotate them)</h3>
<p>Now we will use the function <code>GRanges</code> to actually get the genomic ranges of the peaks from MACS. And we will annotate them with the function <code>annotatedPeak</code> and the <code>genes</code> function to map them to the closer gene.</p>
<p>Basically we are using the information about the genes (start, end, etc) to see which is the closest one to each peak.</p>
<div class="sourceCode" id="cb200"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb200-1"><a href="chip-sequencing-analysis.html#cb200-1"></a>peaksGR&lt;-<span class="kw">GRanges</span>(macs.res) <span class="co">#create the GRanges object of the macs-table.</span></span>
<span id="cb200-2"><a href="chip-sequencing-analysis.html#cb200-2"></a>annotatedPeak &lt;-<span class="st"> </span><span class="kw">annotatePeakInBatch</span>(peaksGR, <span class="dt">AnnotationData=</span><span class="kw">genes</span>(txdb))</span>
<span id="cb200-3"><a href="chip-sequencing-analysis.html#cb200-3"></a><span class="co">#look at the begining of the table</span></span>
<span id="cb200-4"><a href="chip-sequencing-analysis.html#cb200-4"></a><span class="kw">as.data.frame</span>(<span class="kw">head</span>(annotatedPeak))</span></code></pre></div>
<pre><code>##                    seqnames start   end width strand length abs_summit pileup
## X00001.FBgn0031209    chr2L 34224 34348   125      *    125      34306  20.88
## X00002.FBgn0031209    chr2L 34965 35180   216      *    216      35108  23.26
## X00003.FBgn0267987    chr2L 40369 40577   209      *    209      40492  30.42
## X00004.FBgn0267987    chr2L 57282 57429   148      *    148      57365  22.07
## X00005.FBgn0267987    chr2L 58368 58696   329      *    329      58541  39.37
## X00006.FBgn0051973    chr2L 62014 62139   126      *    126      62048  19.68
##                    X.log10.pvalue. fold_enrichment X.log10.qvalue.
## X00001.FBgn0031209         2.75497         1.97319         1.12350
## X00002.FBgn0031209         3.33362         2.02190         1.65302
## X00003.FBgn0267987         7.01721         2.83398         5.05903
## X00004.FBgn0267987         3.47781         2.08079         1.77350
## X00005.FBgn0267987        12.02019         3.64098         9.82848
## X00006.FBgn0051973         2.42109         1.86559         0.83175
##                                            name  peak     feature
## X00001.FBgn0031209 PeakAna_clk_Ip_vs_INP_peak_1 00001 FBgn0031209
## X00002.FBgn0031209 PeakAna_clk_Ip_vs_INP_peak_2 00002 FBgn0031209
## X00003.FBgn0267987 PeakAna_clk_Ip_vs_INP_peak_3 00003 FBgn0267987
## X00004.FBgn0267987 PeakAna_clk_Ip_vs_INP_peak_4 00004 FBgn0267987
## X00005.FBgn0267987 PeakAna_clk_Ip_vs_INP_peak_5 00005 FBgn0267987
## X00006.FBgn0051973 PeakAna_clk_Ip_vs_INP_peak_6 00006 FBgn0051973
##                    start_position end_position feature_strand insideFeature
## X00001.FBgn0031209          21823        25155              -      upstream
## X00002.FBgn0031209          21823        25155              -      upstream
## X00003.FBgn0267987          54817        55767              +      upstream
## X00004.FBgn0267987          54817        55767              +    downstream
## X00005.FBgn0267987          54817        55767              +    downstream
## X00006.FBgn0051973          25402        65404              -        inside
##                    distancetoFeature shortestDistance fromOverlappingOrNearest
## X00001.FBgn0031209             -9069             9069          NearestLocation
## X00002.FBgn0031209             -9810             9810          NearestLocation
## X00003.FBgn0267987            -14448            14240          NearestLocation
## X00004.FBgn0267987              2465             1515          NearestLocation
## X00005.FBgn0267987              3551             2601          NearestLocation
## X00006.FBgn0051973              3390             3265          NearestLocation</code></pre>
</div>
<div id="change-the-gene-format." class="section level3" number="5.5.4">
<h3><span class="header-section-number">5.5.4</span> Change the gene format.</h3>
<p>What do you notice about the table annotatedPeak? Can you recognize any of the genes? Try to google some of them.</p>
<p>The gene names are now in a format that is general for fly genes. This format is the one we have from flyblase.org, a database for fly genes. These names are useful for databases purposes but are not indicative of their function. Therefore, we want now to put the gene-names that we all know (no the Fb…), to do so we need to use the following packages:</p>
<div class="sourceCode" id="cb202"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb202-1"><a href="chip-sequencing-analysis.html#cb202-1"></a><span class="kw">library</span>(AnnotationDbi) <span class="co">#annotation data base package: https://bioconductor.org/packages/release/bioc/vignettes/AnnotationDbi/inst/doc/IntroToAnnotationPackages.pdf</span></span>
<span id="cb202-2"><a href="chip-sequencing-analysis.html#cb202-2"></a><span class="kw">library</span>(org.Dm.eg.db) <span class="co">#Drosophila melanogaster (Dm) data base</span></span>
<span id="cb202-3"><a href="chip-sequencing-analysis.html#cb202-3"></a><span class="kw">library</span>(dplyr) <span class="co">#this package allows us to manipulate better the data.frames</span></span></code></pre></div>
<div id="get-the-names-of-the-genes" class="section level4" number="5.5.4.1">
<h4><span class="header-section-number">5.5.4.1</span> Get the names of the genes</h4>
<p>What we need now is to build some kind of dictionary that will be able to translate between both name types: FB to Symbol.</p>
<p>So, we first create an object with the <code>GeneNames</code> in both types. To do so we will use the <code>select</code> function.</p>
<p>As you will notice if you try the first line of comand <code>select(org.Dm.eg.db, c(as.character(annotatedPeak$feature)), "SYMBOL", keytype = "ENSEMBL")</code>, there is a problem with this function. Basically this comes from the fact that both <code>AnnotationDbi</code> and <code>dplyr</code> have a function named <code>select</code>. R will call the function from the last package executed. To tell R which package we want to use we have to write: <code>Package::function</code>, in this case: <code>AnnotationDbi::select</code>.</p>
<p>Other solutions to this “function name collision” issue are:</p>
<ol style="list-style-type: decimal">
<li>execute the package from which we want to use the conflicting function in the last place.</li>
<li>Rename the conflicting function after running the first package. In this case:</li>
</ol>
<p><code>library(AnnotationDbi) ##annotation data base package</code>
<code>library(org.Dm.eg.db) ##Drosophila melanogaster (Dm) data base</code>
<code>dm.select=select</code>
<code>library(dplyr)</code></p>
<div class="sourceCode" id="cb203"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb203-1"><a href="chip-sequencing-analysis.html#cb203-1"></a>GeneNames =<span class="st"> </span>AnnotationDbi<span class="op">::</span><span class="kw">select</span>(org.Dm.eg.db, <span class="kw">c</span>(<span class="kw">as.character</span>(annotatedPeak<span class="op">$</span>feature)), <span class="st">&quot;SYMBOL&quot;</span>, <span class="dt">keytype =</span> <span class="st">&quot;ENSEMBL&quot;</span>)</span></code></pre></div>
<pre><code>## &#39;select()&#39; returned many:many mapping between keys and columns</code></pre>
<div class="sourceCode" id="cb205"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb205-1"><a href="chip-sequencing-analysis.html#cb205-1"></a>GeneNames<span class="op">$</span>feature=GeneNames<span class="op">$</span>ENSEMBL</span></code></pre></div>
<blockquote>
<p>How does this looks like?</p>
</blockquote>
<div class="sourceCode" id="cb206"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb206-1"><a href="chip-sequencing-analysis.html#cb206-1"></a><span class="kw">head</span>(GeneNames)</span></code></pre></div>
<pre><code>##       ENSEMBL SYMBOL     feature
## 1 FBgn0031209  Ir21a FBgn0031209
## 2 FBgn0031209  Ir21a FBgn0031209
## 3 FBgn0267987   &lt;NA&gt; FBgn0267987
## 4 FBgn0267987   &lt;NA&gt; FBgn0267987
## 5 FBgn0267987   &lt;NA&gt; FBgn0267987
## 6 FBgn0051973   Cda5 FBgn0051973</code></pre>
<div class="sourceCode" id="cb208"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb208-1"><a href="chip-sequencing-analysis.html#cb208-1"></a><span class="kw">class</span>(GeneNames)</span></code></pre></div>
<pre><code>## [1] &quot;data.frame&quot;</code></pre>
<div class="sourceCode" id="cb210"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb210-1"><a href="chip-sequencing-analysis.html#cb210-1"></a>GeneNames=GeneNames[,<span class="op">-</span><span class="dv">1</span>] <span class="co">#what is this doing? </span></span></code></pre></div>
<p>To see what happened we can look at the object again after that</p>
<div class="sourceCode" id="cb211"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb211-1"><a href="chip-sequencing-analysis.html#cb211-1"></a><span class="kw">head</span>(GeneNames)</span></code></pre></div>
<pre><code>##   SYMBOL     feature
## 1  Ir21a FBgn0031209
## 2  Ir21a FBgn0031209
## 3   &lt;NA&gt; FBgn0267987
## 4   &lt;NA&gt; FBgn0267987
## 5   &lt;NA&gt; FBgn0267987
## 6   Cda5 FBgn0051973</code></pre>
</div>
<div id="create-a-data-frame-with-the-peak-annotation-and-the-new-names" class="section level4" number="5.5.4.2">
<h4><span class="header-section-number">5.5.4.2</span> Create a data frame with the peak annotation and the NEW names</h4>
<p>We will then put the names into the first table. To this end we will use <code>dplyr</code> package function by doing a <code>left_join</code>. This is actually a type of merging in which we keep everything that is in the first object. Why do you think we do this?</p>
<p>We can explore the join options, here are some graphic explanation, and if you want to know more you can go <a href="https://www.rdocumentation.org/packages/dplyr/versions/0.7.8/topics/join">to the manual</a> and try the examples. Also, I would recommend you to read the <a href="https://rstudio.com/wp-content/uploads/2015/02/data-wrangling-cheatsheet.pdf">cheatsheet</a>.</p>
<div class="figure" style="text-align: center"><span id="fig:unnamed-chunk-17"></span>
<img src="macs2_analysis_p0.05/dplyr-joins.png" alt="Different joint options from dplyr. Adapted from cheatsheet." width="300px" />
<p class="caption">
Figure 5.1: Different joint options from dplyr. Adapted from cheatsheet.
</p>
</div>
<div class="sourceCode" id="cb213"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb213-1"><a href="chip-sequencing-analysis.html#cb213-1"></a><span class="kw">class</span>(annotatedPeak) <span class="co"># this tells us the class, which type is it?</span></span>
<span id="cb213-2"><a href="chip-sequencing-analysis.html#cb213-2"></a>annotatedPeak_df=<span class="kw">as.data.frame</span>(annotatedPeak) <span class="co"># we will change it to data.frame to have an object we can manipulate better and write to a table</span></span>
<span id="cb213-3"><a href="chip-sequencing-analysis.html#cb213-3"></a>annotatedPeak_df=<span class="kw">left_join</span>(annotatedPeak_df,GeneNames, <span class="dt">by=</span><span class="st">&quot;feature&quot;</span>) <span class="co">#What is this doing?</span></span></code></pre></div>
<pre><code>## [1] &quot;GRanges&quot;
## attr(,&quot;package&quot;)
## [1] &quot;GenomicRanges&quot;</code></pre>
</div>
</div>
<div id="explore-and-export-the-table" class="section level3" number="5.5.5">
<h3><span class="header-section-number">5.5.5</span> Explore and export the table</h3>
<p>We can now see how the table looks like and export it as a .txt table so we can explore it outside R.</p>
<div class="sourceCode" id="cb215"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb215-1"><a href="chip-sequencing-analysis.html#cb215-1"></a><span class="kw">as.data.frame</span>(<span class="kw">head</span>(annotatedPeak_df))<span class="co">#how it looks?</span></span>
<span id="cb215-2"><a href="chip-sequencing-analysis.html#cb215-2"></a><span class="kw">write.table</span>(annotatedPeak_df,<span class="dt">file =</span> <span class="st">&quot;../macs2_analysis_p0.05/ChipPeakAnno_results.xls&quot;</span>,<span class="dt">row.names =</span> T,<span class="dt">col.names =</span> T,<span class="dt">sep=</span><span class="st">&quot;</span><span class="ch">\t</span><span class="st">&quot;</span>) <span class="co">#this is writing the table, look in your directory and try opening it with excel.</span></span></code></pre></div>
<pre><code>##   seqnames start   end width strand length abs_summit pileup X.log10.pvalue.
## 1    chr2L 34224 34348   125      *    125      34306  20.88         2.75497
## 2    chr2L 34224 34348   125      *    125      34306  20.88         2.75497
## 3    chr2L 34965 35180   216      *    216      35108  23.26         3.33362
## 4    chr2L 34965 35180   216      *    216      35108  23.26         3.33362
## 5    chr2L 40369 40577   209      *    209      40492  30.42         7.01721
## 6    chr2L 40369 40577   209      *    209      40492  30.42         7.01721
##   fold_enrichment X.log10.qvalue.                         name  peak
## 1         1.97319         1.12350 PeakAna_clk_Ip_vs_INP_peak_1 00001
## 2         1.97319         1.12350 PeakAna_clk_Ip_vs_INP_peak_1 00001
## 3         2.02190         1.65302 PeakAna_clk_Ip_vs_INP_peak_2 00002
## 4         2.02190         1.65302 PeakAna_clk_Ip_vs_INP_peak_2 00002
## 5         2.83398         5.05903 PeakAna_clk_Ip_vs_INP_peak_3 00003
## 6         2.83398         5.05903 PeakAna_clk_Ip_vs_INP_peak_3 00003
##       feature start_position end_position feature_strand insideFeature
## 1 FBgn0031209          21823        25155              -      upstream
## 2 FBgn0031209          21823        25155              -      upstream
## 3 FBgn0031209          21823        25155              -      upstream
## 4 FBgn0031209          21823        25155              -      upstream
## 5 FBgn0267987          54817        55767              +      upstream
## 6 FBgn0267987          54817        55767              +      upstream
##   distancetoFeature shortestDistance fromOverlappingOrNearest SYMBOL
## 1             -9069             9069          NearestLocation  Ir21a
## 2             -9069             9069          NearestLocation  Ir21a
## 3             -9810             9810          NearestLocation  Ir21a
## 4             -9810             9810          NearestLocation  Ir21a
## 5            -14448            14240          NearestLocation   &lt;NA&gt;
## 6            -14448            14240          NearestLocation   &lt;NA&gt;</code></pre>
</div>
</div>
<div id="annotate-with-chipseeker" class="section level2" number="5.6">
<h2><span class="header-section-number">5.6</span> Annotate with <code>ChIPseeker</code></h2>
<p>We are going to use now <a href="https://bioconductor.org/packages/release/bioc/vignettes/ChIPseeker/inst/doc/ChIPseeker.html">ChIPseeker</a>, another chip-seq annotation package. We need to do again many things, like extracting the Gene-names. Luckily we already did part of the work.</p>
<div class="sourceCode" id="cb217"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb217-1"><a href="chip-sequencing-analysis.html#cb217-1"></a><span class="kw">library</span>(ChIPseeker)</span>
<span id="cb217-2"><a href="chip-sequencing-analysis.html#cb217-2"></a></span>
<span id="cb217-3"><a href="chip-sequencing-analysis.html#cb217-3"></a><span class="co">#we will use the Genomic Ranges object created previously and the txdb also</span></span>
<span id="cb217-4"><a href="chip-sequencing-analysis.html#cb217-4"></a>peakAnno &lt;-<span class="st"> </span><span class="kw">annotatePeak</span>(peaksGR, <span class="dt">TxDb=</span>txdb, <span class="dt">verbose=</span><span class="ot">FALSE</span>)</span>
<span id="cb217-5"><a href="chip-sequencing-analysis.html#cb217-5"></a>peakAnno_df &lt;-<span class="st"> </span><span class="kw">as.data.frame</span>(peakAnno)</span>
<span id="cb217-6"><a href="chip-sequencing-analysis.html#cb217-6"></a></span>
<span id="cb217-7"><a href="chip-sequencing-analysis.html#cb217-7"></a>GeneNames =<span class="st"> </span>AnnotationDbi<span class="op">::</span><span class="kw">select</span>(org.Dm.eg.db, <span class="kw">c</span>(<span class="kw">as.character</span>(peakAnno_df<span class="op">$</span>geneId)), <span class="st">&quot;SYMBOL&quot;</span>, <span class="dt">keytype =</span> <span class="st">&quot;ENSEMBL&quot;</span>)</span>
<span id="cb217-8"><a href="chip-sequencing-analysis.html#cb217-8"></a>GeneNames<span class="op">$</span>geneId=GeneNames<span class="op">$</span>ENSEMBL</span>
<span id="cb217-9"><a href="chip-sequencing-analysis.html#cb217-9"></a><span class="kw">head</span>(GeneNames)</span></code></pre></div>
<pre><code>##       ENSEMBL SYMBOL      geneId
## 1 FBgn0031209  Ir21a FBgn0031209
## 2 FBgn0031209  Ir21a FBgn0031209
## 3 FBgn0267987   &lt;NA&gt; FBgn0267987
## 4 FBgn0051973   Cda5 FBgn0051973
## 5 FBgn0051973   Cda5 FBgn0051973
## 6 FBgn0051973   Cda5 FBgn0051973</code></pre>
<div class="sourceCode" id="cb219"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb219-1"><a href="chip-sequencing-analysis.html#cb219-1"></a>GeneNames=GeneNames[,<span class="op">-</span><span class="dv">1</span>]</span>
<span id="cb219-2"><a href="chip-sequencing-analysis.html#cb219-2"></a></span>
<span id="cb219-3"><a href="chip-sequencing-analysis.html#cb219-3"></a>peakAnno_df=peakAnno_df <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">left_join</span>(GeneNames, <span class="dt">by=</span><span class="st">&quot;geneId&quot;</span>) <span class="co">#this is merging the two tables by the column Geneld</span></span></code></pre></div>
<div id="explore-and-export-the-output" class="section level3" number="5.6.1">
<h3><span class="header-section-number">5.6.1</span> Explore and Export the output</h3>
<p>If we look at the head of the file we can see that we have a <strong>different annotation format</strong> for the peaks and that we actually have a distance to the TSS.</p>
<p>We will save this file as well.</p>
<div class="sourceCode" id="cb220"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb220-1"><a href="chip-sequencing-analysis.html#cb220-1"></a><span class="kw">head</span>(peakAnno_df)</span>
<span id="cb220-2"><a href="chip-sequencing-analysis.html#cb220-2"></a><span class="kw">write.table</span>(peakAnno_df,<span class="dt">file =</span> <span class="st">&quot;ChIPseekerAnno_results.xls&quot;</span>,<span class="dt">row.names =</span> T,<span class="dt">col.names =</span> T,<span class="dt">sep=</span><span class="st">&quot;</span><span class="ch">\t</span><span class="st">&quot;</span>) <span class="co">#try looking at it on excel or any other spreadsheet editor, what are the differences you see with the previous one?</span></span></code></pre></div>
<pre><code>##   seqnames start   end width strand length abs_summit pileup X.log10.pvalue.
## 1    chr2L 34224 34348   125      *    125      34306  20.88         2.75497
## 2    chr2L 34224 34348   125      *    125      34306  20.88         2.75497
## 3    chr2L 34965 35180   216      *    216      35108  23.26         3.33362
## 4    chr2L 34965 35180   216      *    216      35108  23.26         3.33362
## 5    chr2L 40369 40577   209      *    209      40492  30.42         7.01721
## 6    chr2L 57282 57429   148      *    148      57365  22.07         3.47781
##   fold_enrichment X.log10.qvalue.                         name
## 1         1.97319         1.12350 PeakAna_clk_Ip_vs_INP_peak_1
## 2         1.97319         1.12350 PeakAna_clk_Ip_vs_INP_peak_1
## 3         2.02190         1.65302 PeakAna_clk_Ip_vs_INP_peak_2
## 4         2.02190         1.65302 PeakAna_clk_Ip_vs_INP_peak_2
## 5         2.83398         5.05903 PeakAna_clk_Ip_vs_INP_peak_3
## 6         2.08079         1.77350 PeakAna_clk_Ip_vs_INP_peak_4
##                                         annotation geneChr geneStart geneEnd
## 1     Exon (FBtr0078163/FBgn0051973, exon 7 of 13)       1     21823   25155
## 2     Exon (FBtr0078163/FBgn0051973, exon 7 of 13)       1     21823   25155
## 3     Exon (FBtr0078163/FBgn0051973, exon 5 of 13)       1     21823   25155
## 4     Exon (FBtr0078163/FBgn0051973, exon 5 of 13)       1     21823   25155
## 5 Intron (FBtr0078163/FBgn0051973, intron 2 of 12)       1     54817   55767
## 6                                 Promoter (1-2kb)       1     25402   59268
##   geneLength geneStrand      geneId transcriptId distanceToTSS SYMBOL
## 1       3333          2 FBgn0031209  FBtr0113008         -9069  Ir21a
## 2       3333          2 FBgn0031209  FBtr0113008         -9069  Ir21a
## 3       3333          2 FBgn0031209  FBtr0113008         -9810  Ir21a
## 4       3333          2 FBgn0031209  FBtr0113008         -9810  Ir21a
## 5        951          1 FBgn0267987  FBtr0347585        -14240   &lt;NA&gt;
## 6      33867          2 FBgn0051973  FBtr0078163          1839   Cda5</code></pre>
</div>
<div id="positive-controls." class="section level3" number="5.6.2">
<h3><span class="header-section-number">5.6.2</span> Positive controls.</h3>
<p>We can now explore the data back at <a href="https://igv.org/app/">IGV</a> and see if the genes we get a significantly enriched for this TF are actually enriched.</p>
<p>Lets think about some controls we can do with the data. Which is the protein we are analyzing? Is there any gene we already know that protein might be regulating?</p>
<p>Well, yes. We are analyzing <strong>Clk</strong>, that happens to regulate <strong>tim</strong>.</p>
<p>So, making it more general: Other option to see if our analysis and the data in general make sense is to go to previous literature and see what genes we know that are regulated by this TF. Then, we expect them to be enriched in our analysis.</p>
<div class="sourceCode" id="cb222"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb222-1"><a href="chip-sequencing-analysis.html#cb222-1"></a>peakAnno_df_tim=peakAnno_df[<span class="kw">which</span>(peakAnno_df<span class="op">$</span>SYMBOL<span class="op">==</span><span class="st">&quot;tim&quot;</span>),] <span class="co">#What we are doing here?, remember Lab 2!</span></span>
<span id="cb222-2"><a href="chip-sequencing-analysis.html#cb222-2"></a>peakAnno_df_tim=peakAnno_df_tim[<span class="kw">order</span>(peakAnno_df_tim<span class="op">$</span>X.log10.pvalue.,<span class="dt">decreasing =</span> T),] <span class="co"># we order them by log10(pval), what that really means?</span></span>
<span id="cb222-3"><a href="chip-sequencing-analysis.html#cb222-3"></a></span>
<span id="cb222-4"><a href="chip-sequencing-analysis.html#cb222-4"></a><span class="kw">as.data.frame</span>(<span class="kw">head</span>(peakAnno_df_tim))</span></code></pre></div>
<pre><code>##      seqnames   start     end width strand length abs_summit pileup
## 3983    chr2L 3504149 3508352  4204      *   4204    3507246 140.77
## 3984    chr2L 3504149 3508352  4204      *   4204    3507246 140.77
## 3985    chr2L 3504149 3508352  4204      *   4204    3507246 140.77
## 3986    chr2L 3504149 3508352  4204      *   4204    3507246 140.77
## 3987    chr2L 3504149 3508352  4204      *   4204    3507246 140.77
## 3988    chr2L 3504149 3508352  4204      *   4204    3507246 140.77
##      X.log10.pvalue. fold_enrichment X.log10.qvalue.
## 3983        34.61634         3.45781        31.83545
## 3984        34.61634         3.45781        31.83545
## 3985        34.61634         3.45781        31.83545
## 3986        34.61634         3.45781        31.83545
## 3987        34.61634         3.45781        31.83545
## 3988        34.61634         3.45781        31.83545
##                                name       annotation geneChr geneStart geneEnd
## 3983 PeakAna_clk_Ip_vs_INP_peak_539 Promoter (&lt;=1kb)       1   3493986 3507218
## 3984 PeakAna_clk_Ip_vs_INP_peak_539 Promoter (&lt;=1kb)       1   3493986 3507218
## 3985 PeakAna_clk_Ip_vs_INP_peak_539 Promoter (&lt;=1kb)       1   3493986 3507218
## 3986 PeakAna_clk_Ip_vs_INP_peak_539 Promoter (&lt;=1kb)       1   3493986 3507218
## 3987 PeakAna_clk_Ip_vs_INP_peak_539 Promoter (&lt;=1kb)       1   3493986 3507218
## 3988 PeakAna_clk_Ip_vs_INP_peak_539 Promoter (&lt;=1kb)       1   3493986 3507218
##      geneLength geneStrand      geneId transcriptId distanceToTSS SYMBOL
## 3983      13233          2 FBgn0014396  FBtr0077567             0    tim
## 3984      13233          2 FBgn0014396  FBtr0077567             0    tim
## 3985      13233          2 FBgn0014396  FBtr0077567             0    tim
## 3986      13233          2 FBgn0014396  FBtr0077567             0    tim
## 3987      13233          2 FBgn0014396  FBtr0077567             0    tim
## 3988      13233          2 FBgn0014396  FBtr0077567             0    tim</code></pre>
</div>
<div id="plots-1" class="section level3" number="5.6.3">
<h3><span class="header-section-number">5.6.3</span> Plots</h3>
<p>This package has some useful plot functions so we can explore the results more easily.</p>
<p>First we can see the peaks over the chromosomes. For that we use the function <code>covplot</code>. Its name comes from “coverage plot”.</p>
<p>What do you think about the results? Do they make sense?</p>
<div class="sourceCode" id="cb224"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb224-1"><a href="chip-sequencing-analysis.html#cb224-1"></a><span class="kw">covplot</span>(peaksGR, <span class="dt">weightCol=</span><span class="st">&quot;X.log10.pvalue.&quot;</span>,<span class="dt">chrs=</span><span class="kw">c</span>(<span class="st">&quot;chr2L&quot;</span>,<span class="st">&quot;chr2R&quot;</span>,<span class="st">&quot;chr3L&quot;</span>,<span class="st">&quot;chr3R&quot;</span>,<span class="st">&quot;chr4&quot;</span>,<span class="st">&quot;chrX&quot;</span>,<span class="st">&quot;chrY&quot;</span>))</span></code></pre></div>
<div class="figure" style="text-align: center"><span id="fig:unnamed-chunk-24"></span>
<img src="04-chipSeq_files/figure-html/unnamed-chunk-24-1.png" alt="Coverage plot." width="100%" />
<p class="caption">
Figure 5.2: Coverage plot.
</p>
</div>
<p>And then a general distribution of the peaks in relation with he transcription start site (TSS). For that we use the function <code>peakHeatmap</code> and <code>plotAvgProf2</code>.</p>
<div class="sourceCode" id="cb225"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb225-1"><a href="chip-sequencing-analysis.html#cb225-1"></a><span class="kw">peakHeatmap</span>(peaksGR, <span class="dt">TxDb=</span>txdb, <span class="dt">upstream=</span><span class="dv">1000</span>, <span class="dt">downstream=</span><span class="dv">1000</span>, <span class="dt">color=</span><span class="st">&quot;darkviolet&quot;</span>)</span></code></pre></div>
<div class="figure" style="text-align: center"><span id="fig:unnamed-chunk-25"></span>
<img src="04-chipSeq_files/figure-html/unnamed-chunk-25-1.png" alt="Peak heatmap." width="100%" />
<p class="caption">
Figure 5.3: Peak heatmap.
</p>
</div>
<pre><code>## &gt;&gt; preparing promoter regions...  2020-07-08 18:49:56 
## &gt;&gt; preparing tag matrix...        2020-07-08 18:49:56 
## &gt;&gt; generating figure...       2020-07-08 18:50:01 
## &gt;&gt; done...            2020-07-08 18:50:05</code></pre>
<div class="sourceCode" id="cb227"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb227-1"><a href="chip-sequencing-analysis.html#cb227-1"></a><span class="kw">plotAvgProf2</span>(peaksGR, <span class="dt">TxDb=</span>txdb, <span class="dt">upstream=</span><span class="dv">1000</span>, <span class="dt">downstream=</span><span class="dv">1000</span>, <span class="dt">xlab=</span><span class="st">&quot;Genomic Region (5&#39;-&gt;3&#39;)&quot;</span>, <span class="dt">ylab =</span> <span class="st">&quot;Read Count Frequency&quot;</span>) <span class="co">#Try exploring the options of this function. </span></span></code></pre></div>
<div class="figure" style="text-align: center"><span id="fig:unnamed-chunk-26"></span>
<img src="04-chipSeq_files/figure-html/unnamed-chunk-26-1.png" alt="Average coverage plot." width="100%" />
<p class="caption">
Figure 5.4: Average coverage plot.
</p>
</div>
<pre><code>## &gt;&gt; preparing promoter regions...  2020-07-08 18:50:06 
## &gt;&gt; preparing tag matrix...        2020-07-08 18:50:06 
## &gt;&gt; plotting figure...             2020-07-08 18:50:10</code></pre>
</div>
</div>
<div id="sequence-motif-analysis" class="section level2" number="5.7">
<h2><span class="header-section-number">5.7</span> Sequence Motif analysis</h2>
<p>Another goal now is to analyze this peaks and see a pattern enrichment and see if we can find a <strong>Binding Motif</strong> for Clk in fly head.</p>
<p>This is basically DNA analysis, so we will have to figure out the regular DNA motifs and see if there is any specific enrichment.</p>
<p>For this we will use the following libraries:</p>
<div class="sourceCode" id="cb229"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb229-1"><a href="chip-sequencing-analysis.html#cb229-1"></a><span class="kw">library</span>(Biostrings); <span class="kw">library</span>(seqLogo); <span class="kw">library</span>(BCRANK); <span class="kw">library</span>(gridExtra)</span></code></pre></div>
<div id="put-the-peak-sequences-in-fasta-format" class="section level3" number="5.7.1">
<h3><span class="header-section-number">5.7.1</span> Put the peak sequences in fasta format</h3>
<p>To parse the corresponding sequences from the reference genome, the <code>getSeq</code> function from the Biostrings package can be used. The following example parses the sequences for each peak set and saves the results to separate FASTA files, one for each peak set. In addition, the sequences in the FASTA files are ranked (sorted) by increasing p-values as expected by some motif discovery tools, such as BCRANK.</p>
<div class="sourceCode" id="cb230"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb230-1"><a href="chip-sequencing-analysis.html#cb230-1"></a><span class="kw">library</span>(<span class="st">&quot;Rsamtools&quot;</span>) <span class="co">#we will use the Rsamtools package for this.</span></span>
<span id="cb230-2"><a href="chip-sequencing-analysis.html#cb230-2"></a></span>
<span id="cb230-3"><a href="chip-sequencing-analysis.html#cb230-3"></a>peaksGR &lt;-<span class="st"> </span>peaksGR[<span class="kw">order</span>(peaksGR<span class="op">$</span>X.log10.pvalue., <span class="dt">decreasing=</span><span class="ot">TRUE</span>)] <span class="co">#order the peaks according to pvalue.</span></span>
<span id="cb230-4"><a href="chip-sequencing-analysis.html#cb230-4"></a></span>
<span id="cb230-5"><a href="chip-sequencing-analysis.html#cb230-5"></a><span class="kw">as.data.frame</span>(<span class="kw">head</span>(peaksGR))</span></code></pre></div>
<pre><code>##   seqnames    start      end width strand length abs_summit pileup
## 1    chr2L  3133811  3135424  1614      *   1614    3134481 140.17
## 2    chr2L  3136702  3137388   687      *    687    3136981 140.77
## 3    chr2L  7649255  7651111  1857      *   1857    7649737 140.77
## 4    chr2L  7661000  7661782   783      *    783    7661451 140.77
## 5    chr2L 14249821 14250599   779      *    779   14250165 140.77
## 6    chr2L 18077759 18081655  3897      *   3897   18078127 140.77
##   X.log10.pvalue. fold_enrichment X.log10.qvalue.
## 1         106.096        12.73315        97.93874
## 2         106.096        12.78695        97.93874
## 3         106.096        12.78695        97.93874
## 4         106.096        12.78695        97.93874
## 5         106.096        12.78695        97.93874
## 6         106.096        12.78695        97.93874
##                              name
## 1  PeakAna_clk_Ip_vs_INP_peak_474
## 2  PeakAna_clk_Ip_vs_INP_peak_477
## 3 PeakAna_clk_Ip_vs_INP_peak_1071
## 4 PeakAna_clk_Ip_vs_INP_peak_1079
## 5 PeakAna_clk_Ip_vs_INP_peak_1893
## 6 PeakAna_clk_Ip_vs_INP_peak_2290</code></pre>
<div class="sourceCode" id="cb232"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb232-1"><a href="chip-sequencing-analysis.html#cb232-1"></a>pseq &lt;-<span class="st"> </span><span class="kw">getSeq</span>(<span class="kw">FaFile</span>(<span class="dt">file =</span> <span class="st">&quot;../macs2_analysis_p0.05/dm6.fa&quot;</span>), peaksGR) <span class="co">#extract the sequence of the peaks using the genome fasta file dm6.fa and the genome-ranges in the object peaksGR</span></span></code></pre></div>
<p>We can now see how the <code>pseq</code> object looks like.</p>
<div class="sourceCode" id="cb233"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb233-1"><a href="chip-sequencing-analysis.html#cb233-1"></a><span class="kw">as.data.frame</span>(<span class="kw">head</span>(pseq))</span></code></pre></div>
<pre><code>##                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           x
## 1                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            ACCCATTAAATTGTCAATATTACTTAAGCCCTTTATGGTATTGGAAACTCCCGTTTCACATAATTAAACATGGAATGCAGCAAAAAATTTTCCGTGCAATTGCAAATGGCATTTTACGAGAGAAAATTGTTGACAATAATGAAGCTGATGAACATTTGTGGTTGTGTTCATTGTCATTGTTGCTGCGTTAGTTATTCTACCATCGGTTGGGGTGCATTTGGGCCAGTCTGGAACTGTTTGCGTCATTGTTCAGTTTTAGTTCTCTGCGGTTGCCTGAAATTGTCGTAATGCATTTACGGACATCGCACACACATGTGGCCCAAGTGCGGTTTTGTAGCTGGAAATGTTGGCTGTGTACTGTAAACAAGATTTTAGCAAACCCACTTGCATTTCTCCTGGGGGTCATGTGTCAGCACTTATAATTTTGTTTAAAGAACTAAGAGAAAAATGTCCACTATCTAGAAAATCATTACTATCAAAAAACCCAATTTATATCAGTAACGTTCGATTTCTAAACTCATATTGACATTTTTGTATGTATATTATGTATGTATATAAATGTTCATATTTGTTTCCCTTTTGGTTGCGTACCTAACCACCACCTATAAATTAGCCCGTTCTGCCAATATTAGCCCTTTCATATCTCGTTACTCATACGCCACGTGGTCACGTTTTTGCCTAAGCTCTACGTAGCTGCACTCGCTGCACTTTCCGCTTACGTTTTGTTATTATTTTCCCCAGTACTCGTTAGCCTTGTCTAGTGCCAAAATGAAATGACAATGTTTTCCCAGCGCACAGAACTCAAATCGTAAATCATTTTCTTTTTTTTGGGGTGTTGGCAAAGGTAAACAATGTCACATAGGAGCCCGCAGTTGTCTGTCAGTAGAGAAAAAGGCAAAAAGATTAGAGATATATGGACTGCGGAGAGCGGGGCAGAATGCGAGATATATAGCAACTCAAGTTTGTGTTGCCACGAACTTTGACAGTTACATGCGCTGCACCATTGCAGAATGACAAACGAAGGCGAAAAAAGCCATGAGTTGCACAAAATGTATTTATCTGTCATTCCAGTTTTCACTTTCGCAAAAAGTGGTAGATTTTGGGTTTTGTGTGGAATCATATCTAGCTTTATAGCTCTTGGGGAACTATAATATGACTTAAATACCAAATATTTATATACTCAAGTTTAATATAATACATTTCACGTAGTTTTAACGCAAAACGGAATATGCTAGAATTTATCTTTTCCACTTCGTTTCCCCTCTGATTCTCGCACTTTCCCCCAAACTCTCGGCGTTTGTGTGTGTGCCTGTCTGGCTTTTCTTTTTCGTCTCCGTTCGTGACAGCTTGTTTTTTTGGGGGCGTGGCGAGGGGCGGAAGGGGTTGGGCATTTGGGTCAACTATCGACTGCAATTTGAGCCTTTCAAACTGTCGCCGACACAAAACGAAGGGCTCAGCTGAAAAAAAAAACACACAGTCAGGCAGAGTAAAAGTTGCGGAAAGTGTGACAGCAACTCATTGCAGATGGACATTTGCCGAGTCTGCTGGGAATCCCCTCAAGTGCTCTGGAAATTTGATTTCGATTTCCATATGATTTTGATTTGGCCAGCGAAC
## 2                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           CTTCCCCTTTTATTACTGTTCCAAGGACATTCAAATTAAGCATTCATTTGCGGTGATATCACCGGCTTTAATGCTCTGAACTCCACGAAGAGTTGACTAACCTCGAACTGTGCTACATTTTTTTATGCACCTCCATCATACACACATTTTGTCGTGTAATTTGCACGCTGAGTCTATTAAATGCACTGCAACCGAGTTGTGTCAGCACCTCAGGTGTACAGAGCTTTCACTCACACTCATATACGATTCATAAACATTTGTTGTGGCGCCCAACGTGGGGCATGAAATGCGACGTGTTACACAAGTGGGAAGAAGAAGGTGCAAGTCATTAAGTAAGCTTGTTTTTGTTCTGATTTTTCTCGTTGTTTTCAGGGAAGAGGCCATAAAAGCTTCGTGCGCCACGCACACATGCACACATAATTATAATGGGCATTAAAACGGACGCCTGTGGCCTAACTCTTAGTTTGTCTTGTTCGCCAGCAGGCTTCTTAACCCTCACACTGTCCAACTTGGCTACCTCTGAGTGCTTTATGGCGCAACTGGTAGAATGATTCGCCGAGCATAATATTTAACTCGGAATTCCCTGCTAAACGCACATAATGTCTGCCCAAGACAGTCCCGGTTCCCAGCGGCGAAATTCATTTTCTTGTCGCTTACAAATTATTTTAAAGGTATTTAAAGTTAGAT
## 3                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         AAAACAGAAGCTCTAGCATTGTTGTGATACATTAAAGAACTTTACTGACCTGGCCAATTTGTGGATAGTGCTGCAGCTCCATCTCGAGCACCCGCATGGACGGCTTGGGGGTTGTCAGCTCCTGGCCCGTGCACATCTCGTAGAGCAGGTGGCCAAAGCAGACGATGTCCACGTTCTCGATCTCGGTGACCGAGCGGGACCACATGACGGCGTTAATGCGCGAACTGAGGCCCAGGAGGCCGTTCTCCAGGCCCGATAACCTGATGGGTGAAAAACGGAATAAATGTTACGGAAAATGCATAATTAAATGGCGGACCCCTTGTGCTTTCCTTCCCTTTTGTTTCGGTCTTAATTATGCAACATATTCGATGGCTACCCTGCCGTATATTGATGGCCAACACGTGGAAACGTCGGCCGCAAAGTGTCTACTTTTATGGATTTATGTGCGAGCGAGAGGGAGCAGGTATCATCTGCTATCTCTTTCCTCACTGGCCATGTGCCTTAATGACAAAGAGCGTATGTCAGACCTGATATGACAATATTATGACACTCTACACAACACAGCGCTGTATATTGCGGATTGGTTGGGGCTTTTGGTTCGAGGGTCCTGCCGGCATTTCCTAGTATTCATTAGGCCAAATGTGGCTGACTAGTTGGAAAGGTATTCCGAATTGGCTGACAATAGAGGTTCTGAAGATGCTAGTTGTCGTGTGCTATAGTTTATTGGCTTTTGTTGCCAGTTGCCTTTGTTTATTTTATGATCATTTTAATTAGTTTTGAAAATCAGATAAGTATAAATATACGAAAAAAAATCATTTGGGCTTAAAAAAGTTCAATACAAATTGTTGAGTCAACAGGTTACTCCAGAAGTATTTGTTGTCAAATTTACTATCAAATATAAGCATGTTTTTCTTTAGCTGTTATAAAACAATAAAAGCGTTGTGCAGACATTAAATGCTTTCTTTTATTGTCATTGCAAATATCCTGAAATTCTTCACTCAATTTCACTTGAGCAAGCATTTTCTTTTCTACTTCGTCAATCAGCTTTTCAGCTTACTAAATTCCATTTTACCCGTTTTCTTCACGTTGGTCTTTCAACTTTCCTGTGGCCCTATCAATAGCTGTACGTATGTATAAGCAATTTATATGAAAATCAGCTTTTCAATGCGCACAGCGATACCCTGGCGACGAAGGCAGCAAAATTGGGTCATGCACTTGGCGCAAACTTGAACGCAGAAAATCCGCACTTTAATCGACTTTCACCTATAGGAATTCTAGCTTGCAGATCCCACCCTCTTTTAGTCCCGTCCCTGGGCTGCAATATAACCATCTTTTTCGCCGACCATTTATTTTTAAAATGGCAAAAAGCTTAAGCTTTATTTTTGTTACACCCATTCGATGTTTGCAAGTGGGTGGTTTAGTGGGTGGCGCTTACGCGTTGTCGCACAGCAGCTACATGGATAGGAGGGGGCCAGTCAGGGGCTCACGAAACAGGGACATGCATTTAAAGTGCCCTGAAATGGGCAACGATTCTGGGGAATTGCTTTTAATTTGCCATTTAGGCTGAAATCGATGTCGGTTCTATTTGGGTGAATTTTGAATGACTGAAATTTTGCAGTGGAGATAGGGGGGCAGGCCACCGATTCGATATAAAATATTGCAGCCATTATTAAATTAGTTAACAGTTGAGTGGGTCCCAATCGACAACGGACTCACCTGGCTGCCCCGTTCTGCAGGATGACATTGCCGCTGTGCAGGTGACCGTGAAGCGGAAAACCGCGCTCCTTCAGGAAGAGCAGTGCCTCCAGAATCTGTCGTCCCAGGCGCTGCACCTGGCTCACCGGTAAGCCATTTGGC
## 4                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           GGCGCCAACAATCGTAATGGATCCTGGCATGAAAACGGGATGAGGAGACCCAATGGTCACCGCCCTCTAAATGCCGAAAGTCAACTGCGTCATTGTTTGGGGAGAACAGGCCAGCTCCAGCTGAATTTCCTCGATTTTCCGAGGGGTGAGATAAAGGGCCCCGGGCCAGGATGGCCAGGCCCATTTCCAGTGACCTTGCATCATTAACTTAATTGCTCAAACAGTAGTCGGTCCGTCCAATTGCCGGGCTGAATTATTCAGTTGTTCTGCTCGGCCAACTGGCAATTTTGCGTCTTTACTAATGTCACCACAAGCTCATAGAGGAAGCGCTGTCTCTCTCTATTCGGCGCTGCACTGGAAAAGCCATCCGACAGAACCGTTTTTCCATGGGGGCCGGTGAAAATCCCCCACGTGCATTCGGTGTGGTCGTTGGCCCGTTCACGTTGTCCCCCCATTTTAAAGGGGCGTCACGTGTAGCGGGGCTTAGTCCCCCCCACCACAATTTGACATTTTTTACGAAAACAAAATGCAGAGATACGAAGAGAAAAACCAGGCCCAAACAATTTTCACCGGACTAATTGGATTCAAGAGTTTTCCTGCTGCGCTTTTGTCAACGCATATTGCAACAGAAATATTCATATTTATTTATATATAAAAATTCACTGTCAGTACAGCCTAGCCTATAGTTGAATACATACCTGCATCGTCTTATCCAGTATGAAATTACAACAATTCCACCCAATATCAAACCACCTAAGGCACACCAAAAGAGGGTCTGAAAAG
## 5                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               AGGAAAACTCCTAACAAGCTTTAAAAACCTAGCAAGCTAACTACCTTTTTCTTAATTCTCTGGTTCGTTTCGCACACCTGATTAATGGGTTAATGTATCTATTTTTATGCACCCAGCTGCCACTCAGTTGGCTTTGACTGGTCTCGGGGATAAGTGGCAAAGAGGCCGGCTAATCAGGCCCAAAGGTAAAGCCAAAGCCAAAGCCATGAACCAACGAACCGCCCAACAGCCCAACCACCGAAACGCCCCACCCATCCGCTGGTGACCCACTTGAGCATGCACCGCTCGTGACATTGGGCAGGGAAACGTGCAGAAGCGACGGGAAATCGACAAGAAGACAAACAAAACAGCAAAACGTGCAGAACGTCACTTTCGGGCCGCCTTTTTGTTGTTAATTTAGAGAGATGCGTCACAGCGAAAAGTGTTAAGAAAGAAATGCGCGGAAAATCAGGAAATGTAAGCGGTGAGAACTGCGCATTAAGCATCGCATTGCATCGCACGGCAAAACGCAGCCAAATAAAGCGAAACAACAGCGGAGACAGGCGCAATGTTGACAATTGTTGAAACTGACAGTTTGACGTTTTAACTCACGCGCCAAACGCCAAACGTCAAACGGCAGCAACAACCAACACAATATCAACATCAGCAACATAGTAATACGTTGTACGGCCAAACGGCAATCTAGGCAAATCCACCGAGTAGACAACTCAATGAGCCATTTTGATGGACACCTCCGACGACAGCTGTACGGCACACGAATGTATATAATGCATATTCAT
## 6 TGGAATACTTGGAATTTATTAAGTACCTCGTTGTTATAACTAGTAGTTGTCTCCAGTTAACATAAAGCTATTATAAATGTCATAATAAACAACCGCTTATCAGTACTTAGCCGACGAGTGCTTAGGGCTCAATTAAATTAACAACAATTACGTAAATGGAAAAGAACAAAACCCACCACGTAATGTTTGGGTTTAAATACGTCATCCTAGGCGGAAAACAACAAACCAAAATACGCATACTAAATCGATTTCTCGAGCTATTTCTGTACATTCACCTGTCCTGCATTGCTAATACGCCGTGTTGCTCGCGCGTTATTTAATGTTTGAGCCATCGATGTCGATGTCGTGCTGCAATGTCAATATCAAAGACACTGCGCACAGCAAGGTTGCCGAAGCCGTAGTAGTTTACCGCCGTGCAATTGCTGAATTTCTGCTGTGCGGCTAATTGAATTTAGAGGGGCGACAGGTGCCACAATGCCAGGTATAAATGCCGGATTGCCAAAGAGCGCTAATTAATAGCCTAGTGGACCACGCAACGCGGCGTATACCATCGAGAACGAGCGCGAAACGTTAAAGGCACATCCAAAGTTTAAACTATTTCCGCAGAGATTTTGATAAACAGCTCCAAAATGGTGGTCAATTTCAAGGTGTTCAAGAAGTGTTCCCCGAACAACATGATCACGCTCTACATGAACAGGCGTGATTTTGTAGATTCCGTGACTCAGGTGGAACCCATTGGTAGGTGTCACAGACCGAAACCCTTGAGCAATGGGATTTACGAATGAGGAAATCCATCAAAAAATAAATTCGTGTAGGAATTGGTACCCATATTCGATTGAAGTATCTTATAGTTTGAAAATAACTTCAGTGTAACTTTTGTTTCAACTTAACACATTGGAATTTTTAATACCTTCCTTGAAAAGTGATATCAAATCAAAATTATATTATAAAAACTCCATTTCGAATCTGCATATGCCGACCAGCAAATATAAACTCAGGGAGTTATTCAAAATTGCATCTGAATTCAATAGCCCAGGGAGTTAAGTTAAATTGGCTGCGCTAGCAGCTAACCAAGTTCATCGATTACGCGAGCAAGCAAACCAAGAGGCTGGGCGCTTGTAAATAATATTCTCCAATTAATAAGCGTCCTCTTGCAGATGGAATCATTGTGCTGGACGATGAGTACGTGCGCCAGAACCGCAAGATCTTCGTGCAGTTGGTCTGCAATTTCCGATATGGGCGCGAGGACGACGAGATGATCGGTCTGCGGTTCCAGAAGGAACTGACCCTGGTCTCGCAGCAGGTGTGCCCACCCCAGAAGCAGGACATCCAGTTGACCAAGATGCAGGAGCGTCTGCTGAAGAAGCTTGGCTCCAATGCCTATCCCTTCGTGATGCAGATGCCACCAAGCTCGCCGGCCTCGGTGGTTCTCCAGCAGAAGGCCAGTGACGAGAGCCAGCCCTGCGGAGTCCAGTACTTCGTAAAGATCTTTACCGGAGACAGCGACTGCGATCGATCGCATCGCAGGAGCACCATTAACCTGGGCATCCGCAAGGTGCAGTACGCACCGACCAAGCAGGGCATCCAGCCCTGCACCGTCGTTCGCAAGGACTTCCTTCTGTCGCCCGGAGAGCTCGAACTGGAGGTCACCCTCGACAAGCAGCTGTACCATCACGGCGAGAAGATCTCGGTGAACATCTGCGTGCGCAACAACTCCAACAAGGTGGTGAAGAAGATCAAGGCCATGGTGCAGCAGGGCGTCGATGTGGTCCTGTTCCAGAACGGTCAGTTCCGCAACACGATCGCCTTCATGGAGACGAGCGAGGGATGTCCCCTGAACCCGGGATCCAGCCTGCAGAAGGTCATGTATCTGGTGCCCACCCTGGTGGCCAATTGCGACCGCGCAGGCATCGCCGTTGAGGGTGATATCAAGCGCAAAGACACAGCTCTGGCCTCGACCACACTGTGAGTAAAATTTATTCACATCATAGCTTAGCAGATGAAACATTAATATTATACTCTATTAAGTATCAACTTAAAATCATACCATAAAATCAATCAAATTTTAAAGTTAGGAACCTTTTTAAAAATCGTATTTTCCCGGTGACTAACAGTTCTTTAGCTAAATGTGTTTACAAAATGGCATAAAACGCATACTAATACTAAGTGAAAAATGCATATTTAAAATTCTATTTCAGTATTGCCAGTCAGGATGCGAGGGATGCCTTTGGCATAATTGTTTCATATGCTGTGAAGGTCAAGCTTTTCTTGGGAGCCCTGGGCGGCGAGCTCTGCGCTGAGCTACCATTTATTCTGATGCACCCGAAGGTAATAAAAGGTGTGCCCAAATATTTGAATAGTTATTGAAAGGCAATCAATTATTTACAGCCAAGTCGCAAGGCCCAACTGGAAGCCGAGGGCTCCATTGAGGCCTAAACTGAAAGGGCTACCTCAACCAACGAAAAAAATGGCGTATTTCTACAAGTCAAACCGATTTTTGTAGATCCTAAAAAATGCTGATGTTGCTGAAATGTTCTGAACTGCAGTCGTCGTACTTTTCCTATATAGCAAATCCAATATCCATATATTGTATGTGTGTATGTGTATTATATTTATAACTCAACTAACAATTAAATATGAACAGAGTTTATGTATGTATTTTGGAGTATTCTATTGAATTTAGCACGGTGTATTTGAAAAGGCTCCAGCATTGAAAGTTTGTATGGAATGCGCACTAAATATTTAATAATGTGCTTACGAAGGCATTTCGTAGTATTTGATATCTTGCAATGTCTGCTGATTATGTACATTGAAGTGCAATGGGGAAATCAACAGAAGCCAGTGCAATCTATTCAATTACTAATAGTGGGTCTTGCATTTGTGGCTTAGTAATTCCAATTATTGCTACTCTGAAAAGCCGAGGAGCAGCCTAATTAATACTTGGCCACTATGCTGGAGGAAGTTTACTGAACTGAATTCGAGTAAGGAAAATGGACAATAATTGATATAATATGGTGAGCTTCTTGCTGGACTTTGAAATCGTAAAATTTAAGCGAACACACTTCAAACGCATCCATTTAATTTGTGAATGTTTGCAGTCCCACTTTTAATAAGCACCCAATATTAACGATAACGCCACTCTAATCAAAATTTTCCAATAGTCAGGGTTGAAATACTGATCAATCACGCTGCCAACATTTCGGCAGACCAGGTGGGTAATGAGTTTAAAATGGTTTTGCGTAATGGGATTAATCGAATTTCATTAAGGAAGATTAGATTGCCGTCTTTGGAAGTGATCTTTTATAGTGGCTGACCATAAAAATTGCATTGCAAATACTAATTTAAGCATACATGCTATATAACCGATAAGATGGGCGAGCGTCAAGGCAAAAATAGTTGACCGTATTAATAGTTTAATCAACTAGCTTCAAGTTAATTTATAATGCGAATTAGGAAGCACTCTGGCATGCTATTAAAAACTTAAGAACTGATAAACGAAACTTAATTCCTAAAATAAAAATGTACCTAATTACTTTTATATACTATTATAAATAAAATTGTACCATGTATCGTTAAATTTGATTTAGTTACCAAGTGGTATTTGGTACGTGGCAGCATGAAATAGCTACTACTGCTAGTCTGGCTGATTAGCCAGCACTCTCAATAAACTAAGTGCAGCGTTTTGCATTTATCAGGATTTTTGGTACTCTAAACACACACTTAGATCCCAATCACCCCACAGAATAAGTTGAGCAAACCAAACCGAGCTGATTACCACAGTAGACATGATGATTAGCCGCTGCTTTATTTACTAGTGGATAATCTACTAAGCGACGCATGAATAAAAACTCGAGCGATATTTTTCCACTTTGCAGTCGCTCGAAAGCCTTTGTTTCG</code></pre>
<div class="sourceCode" id="cb235"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb235-1"><a href="chip-sequencing-analysis.html#cb235-1"></a><span class="kw">writeXStringSet</span>(pseq, <span class="dt">filepath =</span> <span class="st">&quot;peaksGR.fasta&quot;</span>) <span class="co">#use the names and save the peaks in fasta format, how this looks like? open it outside R! you can shange the filepath to save it any place you want.</span></span></code></pre></div>
</div>
<div id="find-the-motifs" class="section level3" number="5.7.2">
<h3><span class="header-section-number">5.7.2</span> Find the MOTIFS</h3>
<p>The Bioconductor package <a href="https://www.bioconductor.org/packages//2.12/bioc/vignettes/BCRANK/inst/doc/BCRANK.pdf">BCRANK</a> is one of the many available for de novo discovery of DNA binding motifs in peak regions of ChIP-Seq.</p>
<p>The main function we are using here is bcrank. when looking at the documentation we see that:</p>
<p>“BCRANK uses a heuristic search strategy. First a score is computed for an initial short consensus sequence, typically selected at random. The score considers both the number of consensus occurrences and the rank of the genomic regions. Then all consensus sequences in a neighborhood of the start guess are evaluated and the one with highest score is kept as the starting point for the next iteration. When a local optimum is found, the algorithm is terminated and the locally optimal consensus is reported as a result. In order to increase the chance of detecting the globally optimal solution, the algorithm may be restarted several times using different random starting points. Alternatively, BCRANK can be used for assigning scores to previously established consensus sequences. The sections below describe in more detail how the neighborhood, scoring function and start guess are implemented.”</p>
<p>We will use 25 restarts and a penalty for both repetitive sequences and non-canonical letters.</p>
<p>P1 - Penalty on non-specific bases. Let l be the length of the consensus sequence and b the
total number of fixed bases (A, C, G, T) in the sequence. If there are no fixed bases, b is set
to 0.5. The penalty is then defined as P1 = b/l.
P2 - Penalty on repetitive motifs. Let rn, n ∈ 1, 2 be the number of input DNA regions that
contain at least n occurrences of the consensus. Then P2 = 1 − (r2/r1).</p>
<pre><code>set.seed(0)
BCRANKout &lt;- bcrank(&quot;peaksGR.fasta&quot;, restarts=25, use.P1=TRUE, use.P2=TRUE)</code></pre>
</div>
<div id="explore-the-results" class="section level3" number="5.7.3">
<h3><span class="header-section-number">5.7.3</span> Explore the results</h3>
<p>Then we can also see the results, we will se the results that are in the top.</p>
<p>We can first explore the results: the matrix shows the proportion of each letter in each possition for thar specific motif.</p>
<div class="sourceCode" id="cb237"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb237-1"><a href="chip-sequencing-analysis.html#cb237-1"></a><span class="kw">head</span>(<span class="kw">toptable</span>(BCRANKout))</span>
<span id="cb237-2"><a href="chip-sequencing-analysis.html#cb237-2"></a>a&lt;-BCRANKout<span class="op">@</span>toplist</span>
<span id="cb237-3"><a href="chip-sequencing-analysis.html#cb237-3"></a>a[[<span class="dv">1</span>]]</span></code></pre></div>
<pre><code>##   Consensus    Score
## 1     CACGT 663.2068
## 2     CACGT 648.6057
## 3    GCACGT 550.5658
## 4    ACGTGC 536.9913
## 5    CAAAAG 491.8869
## 6    AAAGCG 491.6031
## 
## An object of class &quot;BCRANKsearch&quot;
## 
## Search path, starting from SHVWHRYYDT:
## 
##     Consensus     Score
## 1  SHVWHRYYDT  26.19329
## 2  SHCWHRYYDT  99.05250
## 3  SHCWHRTYDT 147.47039
## 4  SHCWHRTTDT 178.46498
## 5   HCWHRTTDT 203.84605
## 6   HCAHRTTDT 263.87039
## 7    CAHRTTDT 315.05930
## 8    CAHGTTDT 344.41459
## 9     CAHGTTD 396.57309
## 10    CACGTTD 498.50181
## 11     CACGTT 599.45575
## 12      CACGT 663.20680
## 
## Position weight matrix for search result (CACGT):
## 
##   1 2 3 4 5
## A 0 1 0 0 0
## C 1 0 1 0 0
## G 0 0 0 1 0
## T 0 0 0 0 1
## 
## 
## Use methods searchPath(object) and pwm(object) to access object slots.</code></pre>
</div>
<div id="plot-the-results" class="section level3" number="5.7.4">
<h3><span class="header-section-number">5.7.4</span> Plot the results</h3>
<p>We can play around with the matrixes and plot them in the known DNA-Logo standard. To do this we will first store the most top motif from <code>toptable</code>. Then we will use the <code>pwa</code> function from BCRANK and the <code>seqLogo</code> function from seqLogo package.</p>
<div class="sourceCode" id="cb239"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb239-1"><a href="chip-sequencing-analysis.html#cb239-1"></a>topMotif &lt;-<span class="st"> </span><span class="kw">toptable</span>(BCRANKout, <span class="dt">i=</span><span class="dv">1</span>)</span>
<span id="cb239-2"><a href="chip-sequencing-analysis.html#cb239-2"></a>weightMatrix &lt;-<span class="st"> </span><span class="kw">pwm</span>(topMotif, <span class="dt">normalize =</span> <span class="ot">FALSE</span>)</span>
<span id="cb239-3"><a href="chip-sequencing-analysis.html#cb239-3"></a>weightMatrixNormalized &lt;-<span class="st"> </span><span class="kw">pwm</span>(topMotif, <span class="dt">normalize =</span> <span class="ot">TRUE</span>)</span>
<span id="cb239-4"><a href="chip-sequencing-analysis.html#cb239-4"></a><span class="kw">seqLogo</span>(weightMatrixNormalized,<span class="dt">ic.scale =</span> T)</span></code></pre></div>
<div class="figure" style="text-align: center"><span id="fig:unnamed-chunk-34"></span>
<img src="04-chipSeq_files/figure-html/unnamed-chunk-34-1.png" alt="Most significant sequence logo." width="100%" />
<p class="caption">
Figure 5.5: Most significant sequence logo.
</p>
</div>
<p>We can now do the same with a different function just to show you that you can do the same things with different approaches. This is using function form the <code>seqLogo</code> package.</p>
<div class="sourceCode" id="cb240"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb240-1"><a href="chip-sequencing-analysis.html#cb240-1"></a>p&lt;-<span class="kw">makePWM</span>(<span class="kw">as.data.frame</span>(weightMatrixNormalized))</span>
<span id="cb240-2"><a href="chip-sequencing-analysis.html#cb240-2"></a>p<span class="op">@</span>consensus</span>
<span id="cb240-3"><a href="chip-sequencing-analysis.html#cb240-3"></a><span class="kw">seqLogo</span>(p)</span></code></pre></div>
<div class="figure" style="text-align: center"><span id="fig:unnamed-chunk-35"></span>
<img src="04-chipSeq_files/figure-html/unnamed-chunk-35-1.png" alt="Most significant sequence logo." width="100%" />
<p class="caption">
Figure 5.6: Most significant sequence logo.
</p>
</div>
<pre><code>## [1] &quot;CACGT&quot;</code></pre>
<p>We will create a table to be able to analyze the data</p>
<div class="sourceCode" id="cb242"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb242-1"><a href="chip-sequencing-analysis.html#cb242-1"></a>topt&lt;-<span class="kw">as.data.frame</span>(<span class="kw">toptable</span>(BCRANKout)) <span class="co">#extract the results table</span></span>
<span id="cb242-2"><a href="chip-sequencing-analysis.html#cb242-2"></a><span class="kw">head</span>(topt)</span></code></pre></div>
<pre><code>##   Consensus    Score
## 1     CACGT 663.2068
## 2     CACGT 648.6057
## 3    GCACGT 550.5658
## 4    ACGTGC 536.9913
## 5    CAAAAG 491.8869
## 6    AAAGCG 491.6031</code></pre>
</div>
<div id="plotting-with-ggplot2" class="section level3" number="5.7.5">
<h3><span class="header-section-number">5.7.5</span> Plotting with Ggplot2</h3>
<p>Now with ggplot we will use a package called ggseqlogo.
This will be nice to learn how to install packages from github (you have to use the package devtools and then the function install_github).
<a href="http://www.bioconductor.org/packages//2.11/bioc/vignettes/seqLogo/inst/doc/seqLogo.pdf" class="uri">http://www.bioconductor.org/packages//2.11/bioc/vignettes/seqLogo/inst/doc/seqLogo.pdf</a></p>
<div class="sourceCode" id="cb244"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb244-1"><a href="chip-sequencing-analysis.html#cb244-1"></a><span class="kw">library</span>(ggplot2)</span>
<span id="cb244-2"><a href="chip-sequencing-analysis.html#cb244-2"></a><span class="co">#install.packages(&quot;devtools&quot;)</span></span>
<span id="cb244-3"><a href="chip-sequencing-analysis.html#cb244-3"></a><span class="kw">library</span>(<span class="st">&quot;devtools&quot;</span>) <span class="co">#this library is literally called &quot;developers tools&quot; and allow us to do more complex things as downloading packages from github</span></span></code></pre></div>
<pre><code>## Loading required package: usethis</code></pre>
<div class="sourceCode" id="cb246"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb246-1"><a href="chip-sequencing-analysis.html#cb246-1"></a><span class="co">#install_github(&quot;omarwagih/ggseqlogo&quot;)</span></span>
<span id="cb246-2"><a href="chip-sequencing-analysis.html#cb246-2"></a><span class="kw">library</span>(ggseqlogo)</span></code></pre></div>
<div id="create-the-matrixes-for-ggplot2" class="section level4" number="5.7.5.1">
<h4><span class="header-section-number">5.7.5.1</span> Create the matrixes for ggplot2</h4>
<p>We will first store all the matrixes in a list so we can then just plot them all together and not only one by one.</p>
<div class="sourceCode" id="cb247"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb247-1"><a href="chip-sequencing-analysis.html#cb247-1"></a><span class="co"># Some example DNA sequences, lets try to go together over what is this loop doing</span></span>
<span id="cb247-2"><a href="chip-sequencing-analysis.html#cb247-2"></a>seqs_list=<span class="kw">list</span>() <span class="co">#first we create an empty list that we will fill up over the loop</span></span>
<span id="cb247-3"><a href="chip-sequencing-analysis.html#cb247-3"></a><span class="cf">for</span>(e <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span><span class="dv">16</span>){ <span class="co">#we will loop 16 times</span></span>
<span id="cb247-4"><a href="chip-sequencing-analysis.html#cb247-4"></a>  <span class="co">#print(e) #we will print every loop</span></span>
<span id="cb247-5"><a href="chip-sequencing-analysis.html#cb247-5"></a>  topMotif &lt;-<span class="st"> </span><span class="kw">toptable</span>(BCRANKout, <span class="dt">i=</span>e) <span class="co">#we get the motif number e (ie, the iteration will let us go from top motif 1 to 16)</span></span>
<span id="cb247-6"><a href="chip-sequencing-analysis.html#cb247-6"></a>weightMatrixNormalized &lt;-<span class="st"> </span><span class="kw">pwm</span>(topMotif, <span class="dt">normalize =</span> <span class="ot">TRUE</span>) <span class="co">#do some process with the motif</span></span>
<span id="cb247-7"><a href="chip-sequencing-analysis.html#cb247-7"></a>seqs_list[[e]]&lt;-weightMatrixNormalized <span class="co">#add the processed motif to the list in position e (ie. the loop allows us to fill up the list)</span></span>
<span id="cb247-8"><a href="chip-sequencing-analysis.html#cb247-8"></a>}</span></code></pre></div>
</div>
<div id="plot" class="section level4" number="5.7.5.2">
<h4><span class="header-section-number">5.7.5.2</span> Plot</h4>
<p>We can now, either plot one by one for each position in the list.</p>
<div class="sourceCode" id="cb248"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb248-1"><a href="chip-sequencing-analysis.html#cb248-1"></a><span class="co"># Get first set of sequences</span></span>
<span id="cb248-2"><a href="chip-sequencing-analysis.html#cb248-2"></a>seqs_dna =<span class="st"> </span>seqs_list[[<span class="dv">1</span>]]</span>
<span id="cb248-3"><a href="chip-sequencing-analysis.html#cb248-3"></a></span>
<span id="cb248-4"><a href="chip-sequencing-analysis.html#cb248-4"></a><span class="co"># Plot a sequence logo with the 2 different methods available</span></span>
<span id="cb248-5"><a href="chip-sequencing-analysis.html#cb248-5"></a>p1 =<span class="st"> </span><span class="kw">ggseqlogo</span>( seqs_dna, <span class="dt">method =</span> <span class="st">&#39;prob&#39;</span> )</span>
<span id="cb248-6"><a href="chip-sequencing-analysis.html#cb248-6"></a>p2 =<span class="st"> </span><span class="kw">ggseqlogo</span>( seqs_dna, <span class="dt">method =</span> <span class="st">&#39;bits&#39;</span> ) <span class="op">+</span><span class="kw">labs</span>(<span class="dt">y=</span><span class="st">&quot;Information Content&quot;</span>) <span class="co">#this changed the name of the `y` axes</span></span>
<span id="cb248-7"><a href="chip-sequencing-analysis.html#cb248-7"></a><span class="kw">grid.arrange</span>(p1, p2)</span></code></pre></div>
<div class="figure" style="text-align: center"><span id="fig:unnamed-chunk-39"></span>
<img src="04-chipSeq_files/figure-html/unnamed-chunk-39-1.png" alt="Most significant sequence logo in probability and percentage of information." width="100%" />
<p class="caption">
Figure 3.10: Most significant sequence logo in probability and percentage of information.
</p>
</div>
<p>Or we can plot all together using the facet function to actually separate them.</p>
<div class="sourceCode" id="cb249"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb249-1"><a href="chip-sequencing-analysis.html#cb249-1"></a><span class="co">#Plot all the first 12 sequences</span></span>
<span id="cb249-2"><a href="chip-sequencing-analysis.html#cb249-2"></a><span class="kw">ggplot</span>() <span class="op">+</span><span class="st"> </span><span class="kw">geom_logo</span>(seqs_list,<span class="dt">method =</span> <span class="st">&#39;prob&#39;</span>) <span class="op">+</span><span class="st"> </span><span class="kw">theme_logo</span>() <span class="op">+</span><span class="st"> </span></span>
<span id="cb249-3"><a href="chip-sequencing-analysis.html#cb249-3"></a><span class="st">  </span><span class="kw">facet_wrap</span>(<span class="op">~</span>seq_group, <span class="dt">ncol=</span><span class="dv">4</span>)</span></code></pre></div>
<div class="figure" style="text-align: center"><span id="fig:unnamed-chunk-40"></span>
<img src="04-chipSeq_files/figure-html/unnamed-chunk-40-1.png" alt="Many significant sequence logo in probability and percentage of information." width="100%" />
<p class="caption">
Figure 3.11: Many significant sequence logo in probability and percentage of information.
</p>
</div>
</div>
</div>
</div>
<div id="extra-how-to-solve-some-common-annotation-issues." class="section level2" number="5.8">
<h2><span class="header-section-number">5.8</span> Extra: How to solve some common annotation issues.</h2>
<p>Lets see some regular problem and how to solve it.</p>
<p>I will show you first a regular problem we can have: annotation files do not correlate with the one previously used for annotation.</p>
<div class="sourceCode" id="cb250"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb250-1"><a href="chip-sequencing-analysis.html#cb250-1"></a>txdb &lt;-<span class="st"> </span><span class="kw">makeTxDbFromGFF</span>(<span class="dt">file=</span><span class="st">&quot;../macs2_analysis_p0.05/Drosophila_melanogaster.BDGP6.92.gtf&quot;</span>, <span class="dt">format =</span> <span class="st">&quot;gtf&quot;</span>, <span class="dt">dataSource=</span><span class="st">&quot;dm6&quot;</span>, <span class="dt">organism=</span><span class="st">&quot;Drosophila melanogaster&quot;</span>)</span>
<span id="cb250-2"><a href="chip-sequencing-analysis.html#cb250-2"></a><span class="kw">saveDb</span>(txdb, <span class="dt">file=</span><span class="st">&quot;./dm6.sqlite&quot;</span>)</span>
<span id="cb250-3"><a href="chip-sequencing-analysis.html#cb250-3"></a>txdb &lt;-<span class="st"> </span><span class="kw">loadDb</span>(<span class="st">&quot;./dm6.sqlite&quot;</span>)</span>
<span id="cb250-4"><a href="chip-sequencing-analysis.html#cb250-4"></a><span class="kw">class</span>(txdb)</span></code></pre></div>
<pre><code>## TxDb object:
## # Db type: TxDb
## # Supporting package: GenomicFeatures
## # Data source: dm6
## # Organism: Drosophila melanogaster
## # Taxonomy ID: 7227
## # miRBase build ID: NA
## # Genome: NA
## # transcript_nrow: 34767
## # exon_nrow: 87482
## # cds_nrow: 62757
## # Db created by: GenomicFeatures package from Bioconductor
## # Creation time: 2020-07-08 18:50:26 -0400 (Wed, 08 Jul 2020)
## # GenomicFeatures version at creation time: 1.38.2
## # RSQLite version at creation time: 2.2.0
## # DBSCHEMAVERSION: 1.2
## [1] &quot;TxDb&quot;
## attr(,&quot;package&quot;)
## [1] &quot;GenomicFeatures&quot;</code></pre>
<p>Now we can actually extract the gene location from the annotation that we created</p>
<div class="sourceCode" id="cb252"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb252-1"><a href="chip-sequencing-analysis.html#cb252-1"></a>ge &lt;-<span class="st"> </span><span class="kw">genes</span>(txdb, <span class="dt">columns=</span><span class="kw">c</span>(<span class="st">&quot;tx_name&quot;</span>, <span class="st">&quot;gene_id&quot;</span>, <span class="st">&quot;tx_type&quot;</span>)) <span class="co">#get the genes genomic ranges</span></span>
<span id="cb252-2"><a href="chip-sequencing-analysis.html#cb252-2"></a><span class="kw">as.data.frame</span>(<span class="kw">head</span>(ge))</span></code></pre></div>
<pre><code>##             seqnames    start      end width strand      tx_name     gene_id
## FBgn0000003       3R  6822498  6822796   299      +  FBtr0081624 FBgn0000003
## FBgn0000008       2R 22136968 22172834 35867      + FBtr0071.... FBgn0000008
## FBgn0000014       3R 16807214 16830049 22836      - FBtr0306.... FBgn0000014
## FBgn0000015       3R 16927212 16972236 45025      - FBtr0415.... FBgn0000015
## FBgn0000017       3L 16615866 16647882 32017      - FBtr0112.... FBgn0000017
## FBgn0000018       2L 10973443 10975293  1851      -  FBtr0080168 FBgn0000018
##                tx_type
## FBgn0000003 transcript
## FBgn0000008 transcript
## FBgn0000014 transcript
## FBgn0000015 transcript
## FBgn0000017 transcript
## FBgn0000018 transcript</code></pre>
<p>Now we will use the function <code>annotatePeakInBach</code></p>
<div class="sourceCode" id="cb254"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb254-1"><a href="chip-sequencing-analysis.html#cb254-1"></a>?<span class="kw">annotatePeakInBatch</span>() <span class="co">#to undestand what are the features we need</span></span>
<span id="cb254-2"><a href="chip-sequencing-analysis.html#cb254-2"></a>peaksGR&lt;-<span class="kw">GRanges</span>(macs.res) <span class="co"># create the GRanges object of the macs-table </span></span>
<span id="cb254-3"><a href="chip-sequencing-analysis.html#cb254-3"></a>annotatedPeak &lt;-<span class="st"> </span><span class="kw">annotatePeakInBatch</span>(peaksGR, <span class="dt">AnnotationData=</span><span class="kw">genes</span>(txdb))</span>
<span id="cb254-4"><a href="chip-sequencing-analysis.html#cb254-4"></a><span class="kw">head</span>(annotatedPeak)</span></code></pre></div>
<pre><code>## GRanges object with 6 ranges and 16 metadata columns:
##             seqnames      ranges strand |    length abs_summit    pileup
##                &lt;Rle&gt;   &lt;IRanges&gt;  &lt;Rle&gt; | &lt;integer&gt;  &lt;integer&gt; &lt;numeric&gt;
##   X00001.NA    chr2L 34224-34348      * |       125      34306     20.88
##   X00002.NA    chr2L 34965-35180      * |       216      35108     23.26
##   X00003.NA    chr2L 40369-40577      * |       209      40492     30.42
##   X00004.NA    chr2L 57282-57429      * |       148      57365     22.07
##   X00005.NA    chr2L 58368-58696      * |       329      58541     39.37
##   X00006.NA    chr2L 62014-62139      * |       126      62048     19.68
##             X.log10.pvalue. fold_enrichment X.log10.qvalue.
##                   &lt;numeric&gt;       &lt;numeric&gt;       &lt;numeric&gt;
##   X00001.NA         2.75497         1.97319          1.1235
##   X00002.NA         3.33362          2.0219         1.65302
##   X00003.NA         7.01721         2.83398         5.05903
##   X00004.NA         3.47781         2.08079          1.7735
##   X00005.NA        12.02019         3.64098         9.82848
##   X00006.NA         2.42109         1.86559         0.83175
##                                     name        peak     feature start_position
##                                 &lt;factor&gt; &lt;character&gt; &lt;character&gt;      &lt;integer&gt;
##   X00001.NA PeakAna_clk_Ip_vs_INP_peak_1       00001        &lt;NA&gt;           &lt;NA&gt;
##   X00002.NA PeakAna_clk_Ip_vs_INP_peak_2       00002        &lt;NA&gt;           &lt;NA&gt;
##   X00003.NA PeakAna_clk_Ip_vs_INP_peak_3       00003        &lt;NA&gt;           &lt;NA&gt;
##   X00004.NA PeakAna_clk_Ip_vs_INP_peak_4       00004        &lt;NA&gt;           &lt;NA&gt;
##   X00005.NA PeakAna_clk_Ip_vs_INP_peak_5       00005        &lt;NA&gt;           &lt;NA&gt;
##   X00006.NA PeakAna_clk_Ip_vs_INP_peak_6       00006        &lt;NA&gt;           &lt;NA&gt;
##             end_position feature_strand insideFeature distancetoFeature
##                &lt;integer&gt;    &lt;character&gt;      &lt;factor&gt;         &lt;numeric&gt;
##   X00001.NA         &lt;NA&gt;           &lt;NA&gt;          &lt;NA&gt;              &lt;NA&gt;
##   X00002.NA         &lt;NA&gt;           &lt;NA&gt;          &lt;NA&gt;              &lt;NA&gt;
##   X00003.NA         &lt;NA&gt;           &lt;NA&gt;          &lt;NA&gt;              &lt;NA&gt;
##   X00004.NA         &lt;NA&gt;           &lt;NA&gt;          &lt;NA&gt;              &lt;NA&gt;
##   X00005.NA         &lt;NA&gt;           &lt;NA&gt;          &lt;NA&gt;              &lt;NA&gt;
##   X00006.NA         &lt;NA&gt;           &lt;NA&gt;          &lt;NA&gt;              &lt;NA&gt;
##             shortestDistance fromOverlappingOrNearest
##                    &lt;integer&gt;              &lt;character&gt;
##   X00001.NA             &lt;NA&gt;                     &lt;NA&gt;
##   X00002.NA             &lt;NA&gt;                     &lt;NA&gt;
##   X00003.NA             &lt;NA&gt;                     &lt;NA&gt;
##   X00004.NA             &lt;NA&gt;                     &lt;NA&gt;
##   X00005.NA             &lt;NA&gt;                     &lt;NA&gt;
##   X00006.NA             &lt;NA&gt;                     &lt;NA&gt;
##   -------
##   seqinfo: 32 sequences from an unspecified genome; no seqlengths</code></pre>
<p>Here we see that the peaks have a lot of NAs so we did something wrong. If we compare the <code>ge</code> object and the annotated peaks object we can see the problem.</p>
<div class="sourceCode" id="cb256"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb256-1"><a href="chip-sequencing-analysis.html#cb256-1"></a><span class="kw">as.data.frame</span>(<span class="kw">head</span>(ge))</span>
<span id="cb256-2"><a href="chip-sequencing-analysis.html#cb256-2"></a><span class="kw">as.data.frame</span>(<span class="kw">head</span>(annotatedPeak))</span></code></pre></div>
<pre><code>##             seqnames    start      end width strand      tx_name     gene_id
## FBgn0000003       3R  6822498  6822796   299      +  FBtr0081624 FBgn0000003
## FBgn0000008       2R 22136968 22172834 35867      + FBtr0071.... FBgn0000008
## FBgn0000014       3R 16807214 16830049 22836      - FBtr0306.... FBgn0000014
## FBgn0000015       3R 16927212 16972236 45025      - FBtr0415.... FBgn0000015
## FBgn0000017       3L 16615866 16647882 32017      - FBtr0112.... FBgn0000017
## FBgn0000018       2L 10973443 10975293  1851      -  FBtr0080168 FBgn0000018
##                tx_type
## FBgn0000003 transcript
## FBgn0000008 transcript
## FBgn0000014 transcript
## FBgn0000015 transcript
## FBgn0000017 transcript
## FBgn0000018 transcript
##           seqnames start   end width strand length abs_summit pileup
## X00001.NA    chr2L 34224 34348   125      *    125      34306  20.88
## X00002.NA    chr2L 34965 35180   216      *    216      35108  23.26
## X00003.NA    chr2L 40369 40577   209      *    209      40492  30.42
## X00004.NA    chr2L 57282 57429   148      *    148      57365  22.07
## X00005.NA    chr2L 58368 58696   329      *    329      58541  39.37
## X00006.NA    chr2L 62014 62139   126      *    126      62048  19.68
##           X.log10.pvalue. fold_enrichment X.log10.qvalue.
## X00001.NA         2.75497         1.97319         1.12350
## X00002.NA         3.33362         2.02190         1.65302
## X00003.NA         7.01721         2.83398         5.05903
## X00004.NA         3.47781         2.08079         1.77350
## X00005.NA        12.02019         3.64098         9.82848
## X00006.NA         2.42109         1.86559         0.83175
##                                   name  peak feature start_position
## X00001.NA PeakAna_clk_Ip_vs_INP_peak_1 00001    &lt;NA&gt;             NA
## X00002.NA PeakAna_clk_Ip_vs_INP_peak_2 00002    &lt;NA&gt;             NA
## X00003.NA PeakAna_clk_Ip_vs_INP_peak_3 00003    &lt;NA&gt;             NA
## X00004.NA PeakAna_clk_Ip_vs_INP_peak_4 00004    &lt;NA&gt;             NA
## X00005.NA PeakAna_clk_Ip_vs_INP_peak_5 00005    &lt;NA&gt;             NA
## X00006.NA PeakAna_clk_Ip_vs_INP_peak_6 00006    &lt;NA&gt;             NA
##           end_position feature_strand insideFeature distancetoFeature
## X00001.NA           NA           &lt;NA&gt;          &lt;NA&gt;                NA
## X00002.NA           NA           &lt;NA&gt;          &lt;NA&gt;                NA
## X00003.NA           NA           &lt;NA&gt;          &lt;NA&gt;                NA
## X00004.NA           NA           &lt;NA&gt;          &lt;NA&gt;                NA
## X00005.NA           NA           &lt;NA&gt;          &lt;NA&gt;                NA
## X00006.NA           NA           &lt;NA&gt;          &lt;NA&gt;                NA
##           shortestDistance fromOverlappingOrNearest
## X00001.NA               NA                     &lt;NA&gt;
## X00002.NA               NA                     &lt;NA&gt;
## X00003.NA               NA                     &lt;NA&gt;
## X00004.NA               NA                     &lt;NA&gt;
## X00005.NA               NA                     &lt;NA&gt;
## X00006.NA               NA                     &lt;NA&gt;</code></pre>
</div>
<div id="extra-detailed-explanation-of-the-macs-output-files" class="section level2" number="5.9">
<h2><span class="header-section-number">5.9</span> Extra: Detailed explanation of the MACS output files</h2>
<blockquote>
<p>NAME_peaks.xls is a tabular file which contains information about called peaks. You can open it in excel and sort/filter using excel functions. Information include:</p>
</blockquote>
<pre><code>  chromosome name
  start position of peak
  end position of peak
  length of peak region
  absolute peak summit position
  pileup height at peak summit, -log10(pvalue) for the peak summit (e.g. pvalue =1e-10, then this value should be 10)
  fold enrichment for this peak summit against random Poisson distribution with local lambda, -log10(qvalue) at peak summit
  Coordinates in XLS is 1-based which is different with BED format.</code></pre>
<blockquote>
<p>NAME_peaks.narrowPeak is BED6+4 format file which contains the peak locations together with peak summit, pvalue and qvalue. You can load it to UCSC genome browser. Definition of some specific columns are:</p>
</blockquote>
<pre><code>  5th: integer score for display calculated as int(-10*log10qvalue). Please note that currently this value might be out of the [0-1000] range defined in UCSC Encode narrowPeak [format](https://genome.ucsc.edu/FAQ/FAQformat.html##format12)
  7th: fold-change
  8th: -log10pvalue
  9th: -log10qvalue
  10th: relative summit position to peak start
  The file can be loaded directly to UCSC genome browser. Remove the beginning track line if you want to analyze it by other tools.</code></pre>
<blockquote>
<p>NAME_summits.bed is in BED format, which contains the peak summits locations for every peaks. The 5th column in this file is -log10pvalue the same as NAME_peaks.bed. If you want to find the motifs at the binding sites, this file is recommended. The file can be loaded directly to UCSC genome browser. Remove the beginning track line if you want to analyze it by other tools.</p>
</blockquote>
<blockquote>
<p>NAME_peaks.broadPeak is in BED6+3 format which is similar to narrowPeak file, except for missing the 10th column for annotating peak summits.</p>
</blockquote>
<blockquote>
<p>NAME_peaks.gappedPeak is in BED12+3 format which contains both the broad region and narrow peaks. The 5th column is 10-log10qvalue, to be more compatible to show grey levels on UCSC browser. Tht 7th is the start of the first narrow peak in the region, and the 8th column is the end. The 9th column should be RGB color key, however, we keep 0 here to use the default color, so change it if you want. The 10th column tells how many blocks including the starting 1bp and ending 1bp of broad regions. The 11th column shows the length of each blocks, and 12th for the starts of each blocks. 13th: fold-change, 14th: -log10pvalue, 15th: -log10qvalue. The file can be loaded directly to UCSC genome browser.</p>
</blockquote>
<blockquote>
<p>NAME_model.r is an R script which you can use to produce a PDF image about the model based on your data. Load it to R by:</p>
</blockquote>
<p><code>$ Rscript NAME_model.r</code></p>
<p>Then a pdf file NAME_model.pdf will be generated in your current directory. Note, R is required to draw this figure.</p>
<blockquote>
<p>The .bdg files are in bedGraph format which can be imported to UCSC genome browser or be converted into even smaller bigWig files. There are two kinds of bdg files: treat_pileup, and control_lambda.</p>
</blockquote>
</div>
<div id="activity-3" class="section level2" number="5.10">
<h2><span class="header-section-number">5.10</span> Activity</h2>
<blockquote>
<p>Slect one gene of interest and find the enrichment score.
Load the aligned data in IGV and look at the peaks. Data is available in the book repository.
Do the same analysis in, Cyc, the other protein of interest in the paper. Data is available in the book repository.</p>
</blockquote>
</div>
<div id="resources-and-bibliography-1" class="section level2" number="5.11">
<h2><span class="header-section-number">5.11</span> Resources and Bibliography</h2>
<p>Dubowy C, Sehgal A. Circadian Rhythms and Sleep in Drosophila melanogaster. Genetics. 2017;205(4):1373-1397. <a href="doi:10.1534/genetics.115.185157" class="uri">doi:10.1534/genetics.115.185157</a></p>
<p>MEIRELES-FILHO, Antonio Carlos Alves and KYRIACOU, Charalambos Panayiotis. Circadian rhythms in insect disease vectors. Mem. Inst. Oswaldo Cruz [online]. 2013, vol.108, suppl.1 [cited 2020-07-08], pp.48-58.</p>
<p>A.C.A. Meireles-Filho, A.F. Bardet, J.O. Yáñez-Cuna, G. Stampfel, A. Stark
cis-regulatory requirements for tissue-specific programs of the circadian clock
Curr Biol, 24 (2014), pp. 1-10</p>
<p>Zhang, Y., Liu, T., Meyer, C.A. et al. Model-based Analysis of ChIP-Seq (MACS). Genome Biol 9, R137 (2008). <a href="https://doi.org/10.1186/gb-2008-9-9-r137" class="uri">https://doi.org/10.1186/gb-2008-9-9-r137</a></p>
<p>Feng, J., Liu, T., Qin, B. et al. Identifying ChIP-seq enrichment using MACS. Nat Protoc 7, 1728–1740 (2012). <a href="https://doi.org/10.1038/nprot.2012.101" class="uri">https://doi.org/10.1038/nprot.2012.101</a></p>
<p><a href="https://bioconductor.org/packages/release/bioc/vignettes/ChIPseeker/inst/doc/ChIPseeker.html" class="uri">https://bioconductor.org/packages/release/bioc/vignettes/ChIPseeker/inst/doc/ChIPseeker.html</a></p>
<p><a href="https://www.bioconductor.org/packages/release/bioc/vignettes/ChIPpeakAnno/inst/doc/pipeline.html" class="uri">https://www.bioconductor.org/packages/release/bioc/vignettes/ChIPpeakAnno/inst/doc/pipeline.html</a></p>
</div>
<div id="session-info-all-the-packages-installed." class="section level2" number="5.12">
<h2><span class="header-section-number">5.12</span> Session info: all the packages installed.</h2>
<p>This is useful when we want to de-bug a code or share a code or a problem with someone.</p>
<div class="sourceCode" id="cb260"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb260-1"><a href="chip-sequencing-analysis.html#cb260-1"></a><span class="kw">toLatex</span>(<span class="kw">sessionInfo</span>())</span></code></pre></div>
<pre><code>## \begin{itemize}\raggedright
##   \item R version 3.6.2 (2019-12-12), \verb|x86_64-apple-darwin15.6.0|
##   \item Locale: \verb|en_US.UTF-8/en_US.UTF-8/en_US.UTF-8/C/en_US.UTF-8/en_US.UTF-8|
##   \item Running under: \verb|macOS Mojave 10.14.6|
##   \item Random number generation:  \item RNG:    \verb|Mersenne-Twister|  \item Normal: \verb|Inversion|  \item Sample: \verb|Rounding|
##   \item Matrix products: default
##   \item BLAS:   \verb|/Library/Frameworks/R.framework/Versions/3.6/Resources/lib/libRblas.0.dylib|
##   \item LAPACK: \verb|/Library/Frameworks/R.framework/Versions/3.6/Resources/lib/libRlapack.dylib|
##   \item Base packages: base, datasets, graphics, grDevices, grid,
##     methods, parallel, stats, stats4, utils
##   \item Other packages: AnnotationDbi~1.48.0, BCRANK~1.48.0,
##     Biobase~2.46.0, BiocGenerics~0.32.0, Biostrings~2.54.0,
##     ChIPpeakAnno~3.20.1, ChIPseeker~1.22.1, devtools~2.3.0,
##     dplyr~1.0.0, forcats~0.5.0, futile.logger~1.4.3,
##     GenomeInfoDb~1.22.1, GenomicFeatures~1.38.2, GenomicRanges~1.38.0,
##     ggplot2~3.3.1, ggseqlogo~0.1, gridExtra~2.3, IRanges~2.20.2,
##     org.Dm.eg.db~3.10.0, purrr~0.3.4, readr~1.3.1, Rsamtools~2.2.3,
##     S4Vectors~0.24.4, seqLogo~1.52.0, stringr~1.4.0, tibble~3.0.1,
##     tidyr~1.1.0, tidyverse~1.3.0, usethis~1.6.1, VennDiagram~1.6.20,
##     webex~0.9.1, XVector~0.26.0
##   \item Loaded via a namespace (and not attached): ade4~1.7-15,
##     AnnotationFilter~1.10.0, askpass~1.1, assertthat~0.2.1,
##     backports~1.1.7, BiocFileCache~1.10.2, BiocManager~1.30.10,
##     BiocParallel~1.20.1, biomaRt~2.42.1, bit~1.1-15.2, bit64~0.9-7,
##     bitops~1.0-6, blob~1.2.1, bookdown~0.19, boot~1.3-25, broom~0.5.6,
##     BSgenome~1.54.0, callr~3.4.3, caTools~1.18.0, cellranger~1.1.0,
##     cli~2.0.2, colorspace~1.4-1, compiler~3.6.2, cowplot~1.0.0,
##     crayon~1.3.4, curl~4.3, data.table~1.12.8, DBI~1.1.0, dbplyr~1.4.4,
##     DelayedArray~0.12.3, desc~1.2.0, digest~0.6.25, DO.db~2.9,
##     DOSE~3.12.0, ellipsis~0.3.1, enrichplot~1.6.1, ensembldb~2.10.2,
##     europepmc~0.4, evaluate~0.14, fansi~0.4.1, farver~2.0.3,
##     fastmatch~1.1-0, fgsea~1.12.0, formatR~1.7, fs~1.4.1,
##     futile.options~1.0.1, gdata~2.18.0, generics~0.0.2,
##     GenomeInfoDbData~1.2.2, GenomicAlignments~1.22.1, ggforce~0.3.1,
##     ggplotify~0.0.5, ggraph~2.0.3, ggrepel~0.8.2, ggridges~0.5.2,
##     glue~1.4.1, GO.db~3.10.0, GOSemSim~2.12.1, gplots~3.0.3,
##     graph~1.64.0, graphlayouts~0.7.0, gridGraphics~0.5-0, gtable~0.3.0,
##     gtools~3.8.2, haven~2.3.1, highr~0.8, hms~0.5.3, htmltools~0.4.0,
##     httr~1.4.1, idr~1.2, igraph~1.2.5, jsonlite~1.6.1,
##     KernSmooth~2.23-17, knitr~1.28, labeling~0.3, lambda.r~1.2.4,
##     lattice~0.20-41, lazyeval~0.2.2, lifecycle~0.2.0, limma~3.42.2,
##     lubridate~1.7.9, magrittr~1.5, MASS~7.3-51.6, Matrix~1.2-18,
##     matrixStats~0.56.0, memoise~1.1.0, modelr~0.1.8, multtest~2.42.0,
##     munsell~0.5.0, nlme~3.1-148, openssl~1.4.1, pillar~1.4.4,
##     pkgbuild~1.0.8, pkgconfig~2.0.3, pkgload~1.1.0, plotrix~3.7-8,
##     plyr~1.8.6, polyclip~1.10-0, prettyunits~1.1.1, processx~3.4.2,
##     progress~1.2.2, ProtGenerics~1.18.0, ps~1.3.3, qvalue~2.18.0,
##     R6~2.4.1, rappdirs~0.3.1, RBGL~1.62.1, RColorBrewer~1.1-2,
##     Rcpp~1.0.4.6, RCurl~1.98-1.2, readxl~1.3.1.9000, regioneR~1.18.1,
##     remotes~2.1.1, reprex~0.3.0, reshape2~1.4.4, rlang~0.4.6,
##     rmarkdown~2.2, rprojroot~1.3-2, RSQLite~2.2.0, rstudioapi~0.11,
##     rtracklayer~1.46.0, rvcheck~0.1.8, rvest~0.3.5, scales~1.1.1,
##     seqinr~3.6-1, sessioninfo~1.1.1, splines~3.6.2, stringi~1.4.6,
##     SummarizedExperiment~1.16.1, survival~3.1-12, testthat~2.3.2,
##     tidygraph~1.2.0, tidyselect~1.1.0, tools~3.6.2, triebeard~0.3.0,
##     tweenr~1.0.1, TxDb.Hsapiens.UCSC.hg19.knownGene~3.2.2,
##     urltools~1.7.3, vctrs~0.3.1, viridis~0.5.1, viridisLite~0.3.0,
##     withr~2.2.0, xfun~0.14, XML~3.99-0.3, xml2~1.3.2, yaml~2.2.1,
##     zlibbioc~1.32.0
## \end{itemize}</code></pre>

</div>
</div>
<div class="psyteachr_footer">
  
</div>
<script>

/* update total correct if #total_correct exists */
update_total_correct = function() {
  if (t = document.getElementById("total_correct")) {
    t.innerHTML =
      document.getElementsByClassName("correct").length + " of " +
      document.getElementsByClassName("solveme").length + " correct";
  }
}

/* solution button toggling function */
b_func = function() {
  var cl = this.parentElement.classList;
  if (cl.contains('open')) {
    cl.remove("open");
  } else {
    cl.add("open");
  }
}

/* function for checking solveme answers */
solveme_func = function(e) {
  var real_answers = JSON.parse(this.dataset.answer);
  var my_answer = this.value;
  var cl = this.classList;
  if (cl.contains("ignorecase")) {
    my_answer = my_answer.toLowerCase();
  }
  if (cl.contains("nospaces")) {
    my_answer = my_answer.replace(/ /g, "");
  }
  
  if (my_answer !== "" & real_answers.includes(my_answer)) {
    cl.add("correct");
  } else {
    cl.remove("correct");
  }

  // match numeric answers within a specified tolerance
  if(this.dataset.tol){
    var tol = JSON.parse(this.dataset.tol);  
    var matches = real_answers.map(x => Math.abs(x - my_answer) < tol)
    if (matches.reduce((a, b) => a + b, 0) > 0) {
      cl.add("correct");
    } else {
      cl.remove("correct");
    }  
  }

  // added regex bit
  if (cl.contains("regex")){
    answer_regex = RegExp(real_answers.join("|"))
    if (answer_regex.test(my_answer)) {
      cl.add("correct");
    }  
  }
  
  update_total_correct();
}

window.onload = function() {
  /* set up solution buttons */
  var buttons = document.getElementsByTagName("button");

  for (var i = 0; i < buttons.length; i++) {
    if (buttons[i].parentElement.classList.contains('solution')) {
      buttons[i].onclick = b_func;
    }
  }
  
  /* set up solveme inputs */
  var solveme = document.getElementsByClassName("solveme");

  for (var i = 0; i < solveme.length; i++) {
    /* make sure input boxes don't auto-anything */
    solveme[i].setAttribute("autocomplete","off");
    solveme[i].setAttribute("autocorrect", "off");
    solveme[i].setAttribute("autocapitalize", "off"); 
    solveme[i].setAttribute("spellcheck", "false");
    solveme[i].value = "";
    
    /* adjust answer for ignorecase or nospaces */
    var cl = solveme[i].classList;
    var real_answer = solveme[i].dataset.answer;
    if (cl.contains("ignorecase")) {
      real_answer = real_answer.toLowerCase();
    }
    if (cl.contains("nospaces")) {
      real_answer = real_answer.replace(/ /g, "");
    }
    solveme[i].dataset.answer = real_answer;
    
    /* attach checking function */
    solveme[i].onkeyup = solveme_func;
    solveme[i].onchange = solveme_func;
  }
  
  update_total_correct();
}

</script>
            </section>

          </div>
        </div>
      </div>
<a href="sequencing-techniques-and-preprocessing.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="rna-seq-analysis.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "google", "twitter", "linkedin", "weibo", "instapaper"],
"google": false
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": {},
"toc": {
"collapse": "section",
"scroll_highlight": true
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
